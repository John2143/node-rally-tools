{"version":3,"file":"bundle.js","sources":["src/config.js","src/decorators.js","src/rally-tools.js","src/providers.js","src/asset.js","src/fswrap.js","src/preset.js","src/notification.js","src/rule.js","src/supply-chain.js","src/index.js","src/unitTestRally.js","src/baseCode.js","src/config-create.js","src/cli.js"],"sourcesContent":["import {homedir} from \"os\";\nimport {readFileSync} from \"fs\";\n\nexport let configFile = homedir() + \"/.rallyconfig\";\n\nlet configObject;\nexport function loadConfig(file){\n    if(file) configFile = file;\n\n    configObject = {hasConfig: true};\n    try{\n        let json = readFileSync(configFile);\n        configObject = JSON.parse(json);\n    }catch(e){\n        if(e.code == \"ENOENT\"){\n            configObject.hasConfig = false;\n            //ok, they should probably make a config\n        }else{\n            throw e;\n        }\n    }\n}\n\nexport function setConfig(obj){\n    configObject = obj;\n}\n\nloadConfig();\n\nexport {configObject};\n","\n//these are the help entries for each command\nexport let helpEntries = {};\nlet helpEntry = name => helpEntries[name] ? helpEntries[name] : (helpEntries[name] = {name});\n\n//short description\nexport function helpText(text){\n    return function(func, name){\n        helpEntry(name).text = text;\n        return func;\n    }\n}\n\n//flag type argument like -f or --file\nexport function arg(long, short, desc){\n    return function(func, name){\n        let args = helpEntry(name).args = helpEntry(name).args || [];\n        args.unshift({long, short, desc});\n        return func;\n    }\n}\n\n//normal argument\nexport function param(param, desc){\n    return function(func, name){\n        let params = helpEntry(name).params = helpEntry(name).params || [];\n        params.unshift({param, desc});\n        return func;\n    }\n}\n\n//usage string\nexport function usage(usage){\n    return function(func, name){\n        usage = usage.replace(/[\\[<](\\w+)[\\]>]/g, chalk`[{blue $1}]`);\n        helpEntry(name).usage = usage;\n        return func;\n    }\n}\n\nexport function cachedgetter(target, key, desc){\n    let cachedVal;\n\n    let oldget = desc.get;\n    desc.get = function(){\n        if(cachedVal) return cachedVal;\n        return cachedVal = oldget.call(this);\n    };\n    desc.set = function(val){\n        cachedVal = val;\n    };\n}\n\nfunction findValueInCache(args, cache){\n    for(let [argsKey, value] of cache){\n        if(args.length !== argsKey.length) continue;\n        for(let i in argsKey){\n            if(args[i] !== argsKey[i]){\n                continue\n            }\n        }\n        return {found: true, value};\n    }\n    return {found: false};\n}\n\n//This decorator takes a function and returns a function that remembers the\n//  value returned by given arguments\nexport function cached(target, key, desc){\n    let oldFunc = desc.value;\n    let cachedValues = [];\n    function newFunc(...args){\n        let {found, value} = findValueInCache(args, cachedValues);\n        if(!found){\n            //Call the old function to find the value, then store it in the cache\n            value = oldFun(...args);\n            cachedValues.push([args, value]);\n        }\n        return value;\n    }\n    newFunc.clearCache = function(){\n        cachedValues = [];\n    }\n    newFunc.cachePush = function(args, value){\n        cachedValues.push([args, value]);\n    }\n    newFunc.remove = function(...args){\n        let {found, value} = findValueInCache(args, cachedValues);\n        if(found){\n            cachedValues = cachedValues.filter(([arg, item]) => item !== value);\n        }\n    }\n\n    return {\n        ...desc,\n        value: newFunc,\n    };\n}\n\n//Access a deep property of an object: if path is [\"a\", \"b\", \"c\"], then this\n//function retuns obj.a.b.c\nfunction deepAccess(obj, path){\n    let o = obj;\n    for(let key of path){\n        if(!o) return [];\n        o = o[key];\n    }\n    return o;\n}\n\n//This takes a class as the first argument, then adds a getter/setter pair that\n//corresponds to an object in this.data\nexport function defineAssoc(classname, shortname, path){\n    path = path.split(\".\");\n    let lastKey = path.pop();\n\n    Object.defineProperty(classname.prototype, shortname, {\n        get(){\n            return deepAccess(this, path)[lastKey];\n        },\n        set(val){\n            deepAccess(this, path)[lastKey] = val;\n        },\n    });\n}\n\nimport {spawn as cp_spawn} from \"child_process\";\nimport {performance} from \"perf_hooks\";\n\n//Spawn promise decorator, based on https://gist.github.com/Stuk/6226938\nexport function spawn(options, ...args){\n    if(typeof options !== \"object\"){\n        args.unshift(options);\n        options = {};\n    }\n    //todo options\n    return new Promise((resolve, reject) => {\n        let start = performance.now();\n\n        let stdout = \"\";\n        let stderr = \"\";\n        let cp = cp_spawn(...args);\n\n        if(cp.stdout) cp.stdout.on(\"data\", chunk => {stdout += chunk; write(chunk)});\n        if(cp.stderr) cp.stderr.on(\"data\", chunk => {stderr += chunk; write(chunk)});\n\n        cp.on(\"error\", reject);\n        cp.on(\"close\", code => {\n            let end = performance.now();\n            let time = end - start;\n            let timestr = time > 1000 ? (time/100|0)/10 + \"s\" : (time|0) + \"ms\";\n            resolve({stdout, stderr, exitCode: code, time, timestr});\n        });\n    });\n}\n","import chalk from \"chalk\";\nimport {configObject} from \"./config.js\";\nimport {cached} from \"./decorators.js\";\nconst rp = importLazy(\"request-promise\")\n\nglobal.chalk = chalk;\nglobal.log      = (...text) => console.log(...text);\nglobal.write    = (...text) => process.stdout.write(...text);\nglobal.elog     = (...text) => console.log(...text);\nglobal.ewrite   = (...text) => process.stderr.write(...text);\nglobal.errorLog = (...text) => log(...text.map(chalk.red));\n\nexport class lib{\n    //This function takes 2 required arguemnts:\n    // env: the enviornment you wish to use\n    // and either:\n    //  'path', the short path to the resource. ex '/presets/'\n    //  'path_full', the full path to the resource like 'https://discovery-dev.sdvi.com/presets'\n    //\n    // If the method is anything but GET, either payload or body should be set.\n    // payload should be a javascript object to be turned into json as the request body\n    // body should be a string that is passed as the body. for example: the python code of a preset.\n    //\n    // qs are the querystring parameters, in a key: value object.\n    // {filter: \"name=test name\"} becomes something like 'filter=name=test+name'\n    //\n    // headers are the headers of the request. \"Content-Type\" is already set if\n    //   payload is given as a parameter\n    //\n    // fullResponse should be true if you want to receive the request object,\n    //  not just the returned data.\n    static async makeAPIRequest({\n        env, path, path_full,\n        payload, body, method = \"GET\",\n        qs, headers = {},\n        fullResponse = false, timeout = configObject.timeout || 20000\n    }){\n        //Keys are defined in enviornment variables\n        let config = configObject?.api?.[env];\n        if(!config) {\n            throw new UnconfiguredEnvError(env);\n        };\n        //Protect PROD and UAT(?) if the --no-protect flag was not set.\n        if(method !== \"GET\" && !configObject.dangerModify){\n            if(env === \"UAT\" && configObject.restrictUAT || env === \"PROD\"){\n                throw new ProtectedEnvError(env);\n            }\n        }\n\n        let rally_api_key = config.key;\n        let rally_api = config.url;\n\n        path = path_full || rally_api + path;\n        if(payload){\n            body = JSON.stringify(payload, null, 4);\n        }\n\n        if(configObject.vverbose || configObject.vvverbose){\n            log(chalk`${method} @ ${path}`);\n            if(qs){\n                log(qs)\n            }\n        }\n        if(configObject.vvverbose){\n            if(payload || body){\n                log(payload || body);\n            }\n        }\n\n        if(payload){\n            headers[\"Content-Type\"] = \"application/vnd.api+json\";\n        }\n\n        let requestOptions = {\n            method, body, qs, uri: path,\n            timeout,\n            auth: {bearer: rally_api_key},\n            headers: {\n                //SDVI ignores this header sometimes.\n                Accept: \"application/vnd.api+json\",\n                ...headers,\n            },\n            simple: false, resolveWithFullResponse: true,\n        };\n\n        let response;\n        try{\n            response = await rp(requestOptions);\n        }catch(e){\n            if(e?.cause.code === \"ESOCKETTIMEDOUT\"){\n                throw new APIError(response || {}, requestOptions, body);\n            }else{\n                throw e;\n            }\n        }\n\n        //Throw an error for any 5xx or 4xx\n        if(!fullResponse && ![200, 201, 202, 203, 204].includes(response.statusCode)){\n            throw new APIError(response, requestOptions, body);\n        }\n        let contentType = response.headers[\"content-type\"];\n        let isJSONResponse = contentType === \"application/vnd.api+json\" || contentType === \"application/json\";\n\n        if(configObject.vvverbose){\n            log(response.body);\n        }\n\n        if(fullResponse){\n            return response;\n        }else if(isJSONResponse){\n            try{\n                return JSON.parse(response.body);\n            }catch(e){\n                log(response.body);\n                throw new AbortError(\"Body is not valid json: \");\n            }\n        }else{\n            return response.body;\n        }\n    }\n\n    //Index a json endpoint that returns a {links} field.\n    //This function returns the merged data objects as an array\n    //\n    //Additonal options (besides makeAPIRequest options):\n    // - Observe: function to be called for each set of data from the api\n    static async indexPath(env, path){\n        let all = [];\n\n        let opts = typeof env === \"string\" ? {env, path} : env;\n        let json = await this.makeAPIRequest(opts);\n\n        let [numPages, pageSize] = this.numPages(json.links.last);\n        //log(`num pages: ${numPages} * ${pageSize}`);\n\n        all = [...json.data];\n        while(json.links.next){\n            json = await this.makeAPIRequest({...opts, path_full: json.links.next});\n            if(opts.observe) opts.observe(json.data);\n            all = [...all, ...json.data];\n        }\n\n        return all;\n    }\n\n    //Returns number of pages and pagination size\n    static numPages(str){\n        return /page=(\\d+)p(\\d+)/.exec(str).slice(1);\n    }\n\n    static arrayChunk(array, chunkSize){\n        let newArr = [];\n        for (let i = 0; i < array.length; i += chunkSize){\n            newArr.push(array.slice(i, i + chunkSize));\n        }\n        return newArr;\n    }\n\n    static async doPromises(promises, result = [], cb){\n        for(let promise of promises){\n            let res = await promise;\n            result.push(res);\n            if(cb){\n                cb(res.data);\n            }\n        }\n        return result\n    }\n\n    static clearProgress(size = 30){\n        process.stderr.write(`\\r${\" \".repeat(size + 8)}\\r`);\n    }\n\n    static async drawProgress(i, max, size = 30){\n        let pct = Number(i) / Number(max);\n        //clamp between 0 and 1\n        pct = pct < 0 ? 0 : pct > 1 ? 1 : pct;\n        let numFilled = Math.floor(pct * size);\n        let numEmpty = size - numFilled;\n\n        this.clearProgress();\n        process.stderr.write(`[${\"*\".repeat(numFilled)}${\" \".repeat(numEmpty)}] ${i} / ${max}`);\n    }\n\n    //TODO implelement\n    //static async processPromises({\n        //promiseGenerator, chunksize, startingPromises = [],\n        //observe,\n    //}){\n        //let promises = startingPromises\n        //for(let promise of promiseGenerator()){\n        //}\n    //}\n\n\n    //Index a json endpoint that returns a {links} field.\n    //\n    //This function is faster than indexPath because it can guess the pages it\n    //needs to retreive so that it can request all assets at once.\n    //\n    //This function assumes that the content from the inital request is the\n    //first page, so starting on another page may cause issues. Consider\n    //indexPath for that.\n    //\n    //Additional opts, besides default indexPath opts:\n    // - chunksize[10]: How often to break apart concurrent requests\n    static async indexPathFast(env, path){\n        let opts = typeof env === \"string\" ? {env, path} : env;\n        let json = await this.makeAPIRequest(opts);\n\n        let baselink = json.links.first;\n        const linkToPage = page => baselink.replace(\"page=1p\", `page=${page}p`);\n\n        let [numPages, pageSize] = this.numPages(json.links.last);\n        //log(`num pages: ${numPages} * ${pageSize}`);\n\n        //Construct an array of all the requests that are done simultanously.\n        //Assume that the content from the inital request is the first page.\n        let allResults = []\n        let promises = [Promise.resolve(json)];\n\n        opts.chunksize = opts.chunksize || 10\n        for(let i = 2; i <= (opts.limit ? opts.limit : numPages); i++){\n            this.drawProgress(i, opts.limit || numPages);\n            if(promises.length === opts.chunksize){\n                await this.doPromises(promises, allResults, opts.observe);\n                promises = []\n            }\n\n            let req = this.makeAPIRequest({...opts, path_full: linkToPage(i)});\n            promises.push(req);\n        }\n        await this.doPromises(promises, allResults, opts.observe);\n        this.clearProgress();\n\n        let all = [];\n        for(let result of allResults){\n            for(let item of result.data){\n                all.push(item);\n            }\n        }\n\n        return all;\n    }\n    static isLocalEnv(env){\n        return !env || env === \"LOCAL\" || env === \"LOC\";\n    }\n    static envName(env){\n        if(this.isLocalEnv(env)) return \"LOCAL\";\n        return env;\n    }\n};\n\nexport class AbortError extends Error{\n    constructor(message){\n        super(message);\n        Error.captureStackTrace(this, this.constructor);\n        this.name = \"AbortError\";\n    }\n}\n\nexport class APIError extends Error{\n    constructor(response, opts, body){\n        super(chalk`\n{reset Request returned} {yellow ${response?.statusCode}}{\n{green ${JSON.stringify(opts, null, 4)}}\n{green ${body}}\n{reset ${response.body}}\n===============================\n{red ${response.body ? \"Request timed out\" : \"Bad response from API\"}}\n===============================\n        `);\n        this.response = response;\n        this.opts = opts;\n        this.body = body;\n\n        Error.captureStackTrace(this, this.constructor);\n        this.name = \"ApiError\";\n    }\n}\n\nexport class UnconfiguredEnvError extends AbortError{\n    constructor(env){\n        super(\"Unconfigured enviornment: \" + env);\n        this.name = \"Unconfigured Env Error\";\n    }\n}\n\nexport class ProtectedEnvError extends AbortError{\n    constructor(env){\n        super(\"Protected enviornment: \" + env);\n        this.name = \"Protected Env Error\";\n    }\n}\n\nexport class Collection{\n    constructor(arr){\n        this.arr = arr;\n    }\n    [Symbol.iterator](){\n        return this.arr[Symbol.iterator]();\n    }\n    findById(id){\n        return this.arr.find(x => x.id == id);\n    }\n    findByName(name){\n        return this.arr.find(x => x.name == name);\n    }\n    findByNameContains(name){\n        return this.arr.find(x => x.name.includes(name));\n    }\n    log(){\n        for(let d of this){\n            if(d){\n                log(d.chalkPrint(true));\n            }else{\n                log(chalk`{red (None)}`);\n            }\n        }\n    }\n    get length(){return this.arr.length;}\n}\n\n\nexport class RallyBase{\n    static isLoaded(env){\n        if(!this.hasLoadedAll) return;\n        return this.hasLoadedAll[env];\n    }\n    static async getById(env, id, qs){\n        if(this.isLoaded(env)){\n            return (await this.getAll(env)).findById(id);\n        }else{\n            let data = await lib.makeAPIRequest({\n                env, path: `/${this.endpoint}/${id}`,\n                qs\n            });\n            if(data.data) return new this({data: data.data, remote: env, included: data.included});\n        }\n    }\n\n    static async getByName(env, name, qs){\n        if(this.isLoaded(env)){\n            return (await this.getAll(env)).findByName(name);\n        }else{\n            let data = await lib.makeAPIRequest({\n                env, path: `/${this.endpoint}`,\n                qs: {...qs, filter: `name=${name}` + (qs ? qs.filter : \"\")},\n            });\n            //TODO included might not wokr correctly here\n            if(data.data[0]) return new this({data: data.data[0], remote: env, included: data.included});\n        }\n    }\n\n    static async getAllPreCollect(d){return d;}\n    static async getAll(env){\n        this.hasLoadedAll = this.hasLoadedAll || {};\n        if(this.isLoaded(env)) return this.hasLoadedAll[env];\n\n        let datas = await lib.indexPathFast(env, `/${this.endpoint}?page=1p10`);\n        datas = await this.getAllPreCollect(datas);\n        let all = new Collection(datas.map(data => new this({data, remote: env})));\n        this.hasLoadedAll[env] = all;\n        return all;\n    }\n    static async removeCache(env){\n        this.hasLoadedAll = this.hasLoadedAll || {};\n        if(this.isLoaded(env)){\n            this.hasLoadedAll[env] = undefined;\n        }\n    }\n\n    //Specific turns name into id based on env\n    //Generic turns ids into names\n    async resolveApply(type, dataObj, direction){\n        let obj;\n        if(direction == \"generic\"){\n            obj = await type.getById(this.remote, dataObj.id);\n            if(obj){\n                dataObj.name = obj.name\n            }\n        }else if(direction == \"specific\"){\n            obj = await type.getByName(this.remote, dataObj.name);\n            if(obj){\n                dataObj.id = obj.id\n            }\n        }\n        return obj;\n    }\n\n    //Type is the baseclass you are looking for (should extend RallyBase)\n    //name is the name of the field\n    //isArray is true if it has multiple cardinailty, false if it is single\n    //direction gets passed directly to resolveApply\n    async resolveField(type, name, isArray=false, direction=\"generic\"){\n        // ignore empty fields\n        let field = this.relationships[name];\n        if(!field?.data) return;\n\n        if(isArray){\n            return await Promise.all(field.data.map(o => this.resolveApply(type, o, direction)));\n        }else{\n            return await this.resolveApply(type, field.data, direction);\n        }\n    }\n\n    cleanup(){\n        for(let [key, val] of Object.entries(this.relationships)){\n            //Remove ids from data\n            if(val.data){\n                if(val.data.id){\n                    delete val.data.id;\n                }else if(val.data[0]){\n                    for(let x of val.data) delete x.id;\n                }\n            }\n            delete val.links;\n        }\n        // organization is unused (?)\n        delete this.relationships.organization;\n        // id is specific to envs\n        delete this.data.id;\n        // links too\n        delete this.data.links;\n    }\n}\n","import {cached, defineAssoc} from \"./decorators.js\";\nimport {lib, Collection, RallyBase} from \"./rally-tools.js\";\n\nclass Provider extends RallyBase{\n    constructor({data, remote}){\n        super();\n        this.data = data;\n        this.meta = {};\n        this.remote = remote;\n    }\n    //cached\n    async getEditorConfig(){\n        if(this.editorConfig) return this.editorConfig;\n\n        this.editorConfig = await lib.makeAPIRequest({\n            env: this.remote,\n            path_full: this.data.links.editorConfig\n        });\n        this.editorConfig.fileExt = await this.getFileExtension();\n        return this.editorConfig;\n    }\n    static async getAllPreCollect(providers){\n        return providers.sort((a, b) => {\n            return a.attributes.category.localeCompare(b.attributes.category) ||\n                   a.attributes.name    .localeCompare(b.attributes.name);\n        });\n    }\n\n    async getFileExtension(){\n        let config = await this.getEditorConfig();\n        let map = {\n            python: \"py\",\n            text: \"txt\",\n            getmap(key){\n                if(this.name === \"Aurora\") return \"zip\";\n                if(this[key]) return this[key];\n                return key;\n            }\n        }\n        return map.getmap(config.lang);\n    }\n\n    chalkPrint(pad=true){\n        let id = String(this.id)\n        if(pad) id = id.padStart(4);\n        return chalk`{green ${id}}: {blue ${this.category}} - {green ${this.name}}`;\n    }\n}\n\ndefineAssoc(Provider, \"id\", \"data.id\");\ndefineAssoc(Provider, \"name\", \"data.attributes.name\");\ndefineAssoc(Provider, \"category\", \"data.attributes.category\");\ndefineAssoc(Provider, \"remote\", \"meta.remote\");\ndefineAssoc(Provider, \"editorConfig\", \"meta.editorConfig\");\nProvider.endpoint = \"providerTypes\";\n\nexport default Provider;\n","import {cached, defineAssoc} from \"./decorators.js\";\nimport {lib, Collection, RallyBase} from \"./rally-tools.js\";\n\nclass Asset extends RallyBase{\n    constructor({data, remote, included}){\n        super();\n        this.data = data;\n        this.meta = {};\n        this.remote = remote;\n        if(included){\n            this.meta.metadata = Asset.normalizeMetadata(included);\n        }\n    }\n    static normalizeMetadata(payload){\n        let newMetadata = {}\n        for(let md of payload){\n            if(md.type !== \"metadata\") continue;\n            newMetadata[md.attributes.usage] = md.attributes.metadata;\n        }\n        return newMetadata;\n    }\n\n    static lite(id, remote){\n        return new this({data: {id}, remote})\n    }\n\n    chalkPrint(pad=false){\n        let id = String(\"A-\" + (this.remote && this.remote + \"-\" + this.id || \"LOCAL\"))\n        if(pad) id = id.padStart(15);\n        return chalk`{green ${id}}: {blue ${this.data.attributes ? this.name : \"(lite asset)\"}}`;\n    }\n\n    static async createNew(name, env){\n        let req = await lib.makeAPIRequest({\n            env, path: \"/assets\",\n            method: \"POST\",\n            payload: {\n                data: {\n                    attributes: {name},\n                    type: \"assets\"\n                }\n            }\n        });\n        return new this({data: req.data, remote: env});\n    }\n\n    async delete(){\n        let req = await lib.makeAPIRequest({\n            env: this.remote, path: \"/assets/\" + this.id,\n            method: \"DELETE\",\n        });\n    }\n\n    async addFile(label, fileuris){\n        if(!Array.isArray(fileuris)) fileuris = [fileuris];\n\n        let instances = {}\n        for(let i = 0; i < fileuris.length; i++){\n            instances[String(i + 1)] = {uri: fileuris[i]};\n        }\n\n        let req = await lib.makeAPIRequest({\n            env: this.remote, path: \"/files\",\n            method: \"POST\",\n            payload: {\n                \"data\": {\n                    \"attributes\": {\n                        label, instances,\n                    },\n                    \"relationships\": {\n                        \"asset\": {\n                            \"data\": {\n                                id: this.id,\n                                \"type\": \"assets\"\n                            }\n                        }\n                    },\n                    \"type\": \"files\"\n                }\n\n            }\n        });\n        return req;\n    }\n    async startWorkflow(jobName, initData){\n        let attributes;\n        if(initData){\n            //Convert init data to string\n            initData = typeof initData === \"string\" ? initData : JSON.stringify(initData);\n            attributes = {initData};\n        }\n\n        let req = await lib.makeAPIRequest({\n            env: this.remote, path: \"/workflows\",\n            method: \"POST\",\n            payload: {\n                \"data\": {\n                    \"type\": \"workflows\",\n                    attributes,\n                    \"relationships\": {\n                        \"movie\": {\n                            \"data\": {\n                                id: this.id,\n                                \"type\": \"movies\"\n                            }\n                        }, \"rule\": {\n                            \"data\": {\n                                \"attributes\": {\n                                    \"name\": jobName,\n                                },\n                                \"type\": \"rules\"\n                            }\n                        }\n                    }\n                }\n            }\n        });\n        return req;\n    }\n    async startEvaluate(presetid){\n        // Fire and forget.\n        let data = await lib.makeAPIRequest({\n            env: this.remote, path: \"/jobs\", method: \"POST\",\n            payload: {\n                data: {\n                    type: \"jobs\",\n                    relationships: {\n                        movie: {\n                            data: {\n                                id: this.id,\n                                type: \"movies\",\n                            }\n                        }, preset: {\n                            data: {\n                                id: presetid,\n                                type: \"presets\",\n                            }\n                        }\n                    }\n                }\n            }\n        });\n        return data;\n    }\n}\n\ndefineAssoc(Asset, \"id\", \"data.id\");\ndefineAssoc(Asset, \"name\", \"data.attributes.name\");\ndefineAssoc(Asset, \"remote\", \"meta.remote\");\ndefineAssoc(Asset, \"md\", \"meta.metadata\");\nAsset.endpoint = \"movies\"\n\nexport default Asset;\n","import fs from \"fs\";\n\nimport {configObject} from \"./config.js\";\n\nconst colon = /:/g;\nconst siloLike = /(silo\\-\\w+?)s?\\/([^\\/]+)\\.([\\w1234567890]+)$/g;\nexport function pathTransform(path){\n    if(path.includes(\":\")){\n        //Ignore the first colon in window-like filesystems\n        path = path.slice(0, 3) + path.slice(3).replace(colon, \"--\");\n    }\n    if(configObject.invertedPath){\n        path = path.replace(siloLike, \"$2-$1.$3\")\n    }\n    return path;\n}\n\nexport function readFileSync(path, options){\n    return fs.readFileSync(pathTransform(path), options);\n}\nexport function writeFileSync(path, data, options){\n    return fs.writeFileSync(pathTransform(path), data, options);\n}\n","import {RallyBase, lib, AbortError, Collection} from  \"./rally-tools.js\";\nimport {basename, resolve as pathResolve, dirname} from \"path\";\nimport {cached, defineAssoc} from \"./decorators.js\";\nimport {configObject} from \"./config.js\";\nimport Provider from \"./providers.js\";\nimport Asset from \"./asset.js\";\n\nimport {writeFileSync, readFileSync} from \"./fswrap.js\";\nimport path from \"path\";\n\nlet exists = {};\n\nclass Preset extends RallyBase{\n    constructor({path, remote, data} = {}){\n        // Get full path if possible\n        if(path){\n            path = pathResolve(path);\n            if(dirname(path).includes(\"silo-metadata\")){\n                throw new AbortError(\"Constructing preset from metadata file\")\n            }\n        }\n\n        super();\n        // Cache by path\n        if(path){\n            if(exists[path]) return exists[path];\n            exists[path] = this;\n        }\n\n        this.meta = {};\n        this.remote = remote\n        if(lib.isLocalEnv(this.remote)){\n            if(path){\n                this.path = path;\n                let pathspl = this.path.split(\".\");\n                this.ext = pathspl[pathspl.length-1];\n                try{\n                    this.code = this.getLocalCode();\n                }catch(e){\n                    if(e.code === \"ENOENT\" && configObject.ignoreMissing){\n                        this.missing = true;\n                        return undefined;\n                    }else{\n                        log(chalk`{red Node Error} ${e.message}`);\n                        throw new AbortError(\"Could not load code of local file\");\n                    }\n                }\n                let name = this.parseFilenameForName() || this.parseCodeForName();\n                try{\n                    this.data = this.getLocalMetadata();\n                    this.isGeneric = true;\n                    name = this.name;\n                }catch(e){\n                    log(chalk`{yellow Warning}: ${path} does not have a readable metadata file! Looking for ${this.localmetadatapath}`);\n                    this.data = Preset.newShell();\n                    this.isGeneric = false;\n                }\n                this.name = name;\n            }else{\n                this.data = Preset.newShell();\n            }\n        }else{\n            this.data = data;\n            //this.name = data.attributes.name;\n            //this.id = data.id;\n            this.isGeneric = false;\n        }\n        this.data.rallyConfiguration = undefined;\n        this.data.systemManaged = undefined;\n    }\n    //Given a metadata file, get its actualy file\n    static async fromMetadata(path){\n        let data;\n        try{\n            data = JSON.parse(readFileSync(path));\n        }catch(e){\n            if(e.code === \"ENOENT\" && configObject.ignoreMissing){\n                return null;\n            }else{\n                throw e;\n            }\n        }\n        let providerType = data.relationships.providerType.data.name;\n        let provider = await Provider.getByName(\"DEV\", providerType);\n\n        if(!provider){\n            log(chalk`{red The provider type {green ${providerType}} does not exist}`);\n            log(chalk`{red Skipping {green ${path}}.}`);\n            return null;\n        }\n\n        let ext = await provider.getFileExtension();\n        let name = data.attributes.name;\n\n        let realpath = Preset.getLocalPath(name, ext);\n        return new Preset({path: realpath});\n    }\n\n    static newShell(){\n        return {\n            \"attributes\": {\n                \"providerSettings\": {\n                }\n            },\n            \"relationships\": {},\n            \"type\": \"presets\",\n        };\n    }\n    cleanup(){\n        super.cleanup();\n        delete this.attributes[\"createdAt\"];\n        delete this.attributes[\"updatedAt\"];\n    }\n    async acclimatize(env){\n        if(!this.isGeneric) throw new AbortError(\"Cannot acclimatize non-generics or shells\");\n        let providers = await Provider.getAll(env);\n        let ptype = this.relationships[\"providerType\"];\n            ptype = ptype.data;\n\n        let provider = providers.findByName(ptype.name);\n        ptype.id = provider.id;\n    }\n    get test(){\n        if(!this.code) return;\n\n        const regex = /[^-]autotest:\\s?([\\w\\d_\\-. \\/]+)[\\r\\s\\n]*?/gm;\n        let match\n        let matches = []\n        while(match = regex.exec(this.code)){\n            matches.push(match[1]);\n        }\n        return matches\n    }\n    async runTest(env){\n        let remote = await Preset.getByName(env, this.name);\n        for(let test of this.test){\n            log(\"Tests...\");\n            let asset;\n\n            if(test.startsWith(\"id\")){\n                let match = /id:\\s*(\\d+)/g.exec(test);\n                if(!match){\n                    log(chalk`{red Could not parse autotest} ${test}.`);\n                    throw new AbortError(\"Could not properly parse the preset header\");\n                }\n                asset = await Asset.getById(env, match[1]);\n            }else{\n                asset = await Asset.getByName(env, test);\n            }\n\n            if(!asset){\n                log(chalk`{yellow No movie found}, skipping test.`);\n                continue;\n            }\n\n            log(chalk`Starting job {green ${this.name}} on ${asset.chalkPrint(false)}... `);\n            await asset.startEvaluate(remote.id);\n        }\n    }\n    async resolve(){\n        if(this.isGeneric) return;\n\n        let proType = await this.resolveField(Provider, \"providerType\");\n\n        this.ext = await proType.getFileExtension();\n\n        this.isGeneric = true;\n\n        return {proType};\n    }\n    async saveLocal(){\n        await this.saveLocalMetadata();\n        await this.saveLocalFile();\n    }\n    async saveLocalMetadata(){\n        if(!this.isGeneric){\n            await this.resolve();\n            this.cleanup();\n        }\n        writeFileSync(this.localmetadatapath, JSON.stringify(this.data, null, 4));\n    }\n    async saveLocalFile(){\n        writeFileSync(this.localpath, this.code);\n    }\n    async uploadRemote(env){\n        await this.uploadCodeToEnv(env, true);\n    }\n    async save(env){\n        this.saved = true;\n        if(!this.isGeneric){\n            await this.resolve();\n        }\n\n        this.cleanup();\n        if(lib.isLocalEnv(env)){\n            log(chalk`Saving {green ${this.name}} to {blue ${lib.envName(env)}}.`)\n            await this.saveLocal();\n        }else{\n            await this.uploadRemote(env);\n        }\n    }\n\n    async downloadCode(){\n        if(!this.remote || this.code) return this.code;\n        return this.code = await lib.makeAPIRequest({\n            env: this.remote,\n            path_full: this.data.links.providerData,\n            json: false,\n        });\n    }\n\n    get code(){\n        if(this._code) return this._code;\n    }\n    set code(v){this._code = v;}\n\n    chalkPrint(pad=true){\n        let id = String(\"P-\" + (this.remote && this.remote + \"-\" + this.id || \"LOCAL\"))\n        if(pad) id = id.padStart(10);\n        if(this.name == undefined){\n            return chalk`{green ${id}}: {red ${this.path}}`;\n        }else if(this.meta.proType){\n            return chalk`{green ${id}}: {red ${this.meta.proType.name}} {blue ${this.name}}`;\n        }else{\n            return chalk`{green ${id}}: {blue ${this.name}}`;\n        }\n    }\n    parseFilenameForName(){\n        if(this.path.endsWith(\".jinja\") || this.path.endsWith(\".json\")){\n            return basename(this.path)\n                .replace(\"_\", \" \")\n                .replace(\"-\", \" \")\n                .replace(\".json\", \"\")\n                .replace(\".jinja\", \"\");\n        }\n    }\n\n    parseCodeForName(){\n        const name_regex = /name\\s?:\\s([\\w\\d. \\/]+)[\\r\\s\\n]*?/;\n        const match = name_regex.exec(this.code);\n        if(match) return match[1];\n    }\n\n    findStringsInCode(strings){\n        if(!this.code) return [];\n\n        return strings.filter(str => {\n            let regex = new RegExp(str);\n            return !!this.code.match(regex);\n        });\n    }\n    static getLocalPath(name, ext){\n        return path.join(configObject.repodir, \"silo-presets\", name + \".\" + ext);\n    }\n    get localpath(){return Preset.getLocalPath(this.name, this.ext)}\n\n    get path(){\n        if(this._path) return this._path;\n    }\n    set path(val){\n        this._path = val;\n    }\n    get name(){\n        return this._nameOuter;\n    }\n    set name(val){\n        this._nameInner = val;\n        this._nameOuter = val;\n    }\n    set providerType(value){\n        this.relationships[\"providerType\"] = {\n            data: {\n                ...value,\n                type: \"providerTypes\",\n            }\n        };\n    }\n    get localmetadatapath(){\n        let fname = this.name;\n        if(!fname && this.path){\n            let bname = basename(this.path);\n            fname = bname.substring(0, bname.length - (this.ext.length + 1));\n        }\n        return path.join(configObject.repodir, \"silo-metadata\", fname + \".json\");\n    }\n    get immutable(){\n        return this.name.includes(\"Constant\");\n    }\n    async uploadPresetData(env, id){\n        let res = await lib.makeAPIRequest({\n            env, path: `/presets/${id}/providerData`,\n            body: this.code, method: \"PUT\", fullResponse: true, timeout: 5000\n        });\n        write(chalk`code up {yellow ${res.statusCode}}, `);\n    }\n    async grabMetadata(env){\n        let remote = await Preset.getByName(env, this.name);\n        this.isGeneric = false;\n        if(!remote){\n            throw new AbortError(`No file found on remote ${env} with name ${this.name}`);\n        }\n        this.data = remote.data;\n        this.remote = env;\n    }\n    async uploadCodeToEnv(env, includeMetadata, shouldTest = true){\n        if(!this.name){\n            log(chalk`Failed uploading {red ${this.path}}. No name found.`);\n            return;\n        }\n\n        write(chalk`Uploading preset {green ${this.name}} to {green ${env}}: `);\n\n        if(this.immutable){\n            log(chalk`{magenta IMMUTABLE}. Nothing to do.`);\n            return;\n        }\n\n        //First query the api to see if this already exists.\n        let remote = await Preset.getByName(env, this.name);\n\n        if(remote){\n            //If it exists we can replace it\n            write(\"replace, \");\n            if(includeMetadata){\n                let res = await lib.makeAPIRequest({\n                    env, path: `/presets/${remote.id}`, method: \"PATCH\",\n                    payload: {data: {attributes: this.data.attributes, type: \"presets\"}},\n                    fullResponse: true,\n                });\n                write(chalk`metadata {yellow ${res.statusCode}}, `);\n            }\n\n            await this.uploadPresetData(env, remote.id);\n        }else{\n            write(\"create, \");\n            let metadata = {data: this.data};\n            if(!this.relationships[\"providerType\"]){\n                throw new AbortError(\"Cannot acclimatize shelled presets. (try creating it on the env first)\");\n            }\n\n            await this.acclimatize(env);\n            write(\"Posting to create preset... \");\n            let res = await lib.makeAPIRequest({\n                env, path: `/presets`, method: \"POST\",\n                payload: metadata, timeout: 5000,\n            });\n            let id = res.data.id;\n            write(chalk`Created id {green ${id}}... Uploading Code... `);\n            await this.uploadPresetData(env, id);\n        }\n        if(this.test[0] && shouldTest){\n            await this.runTest(env);\n        }else{\n            log(\"No tests. Done.\");\n        }\n    }\n\n    getLocalMetadata(){\n        return JSON.parse(readFileSync(this.localmetadatapath, \"utf-8\"));\n    }\n    getLocalCode(){\n        return readFileSync(this.path, \"utf-8\");\n    }\n}\n\ndefineAssoc(Preset, \"_nameInner\", \"data.attributes.providerSettings.PresetName\");\ndefineAssoc(Preset, \"_nameOuter\", \"data.attributes.name\");\ndefineAssoc(Preset, \"id\", \"data.id\");\ndefineAssoc(Preset, \"attributes\", \"data.attributes\");\ndefineAssoc(Preset, \"relationships\", \"data.relationships\");\ndefineAssoc(Preset, \"remote\", \"meta.remote\");\ndefineAssoc(Preset, \"_code\", \"meta.code\");\ndefineAssoc(Preset, \"_path\", \"meta.path\");\ndefineAssoc(Preset, \"isGeneric\", \"meta.isGeneric\");\ndefineAssoc(Preset, \"ext\", \"meta.ext\");\nPreset.endpoint = \"presets\";\n\nexport default Preset;\n","import {cached, defineAssoc} from \"./decorators.js\";\nimport {lib, Collection, RallyBase} from \"./rally-tools.js\";\n\nclass Notification extends RallyBase{\n    constructor({data, remote}){\n        super();\n        this.data = data;\n        this.meta = {};\n        this.remote = remote;\n    }\n\n    static async getAllPreCollect(notifications){\n        return notifications.sort((a, b) => {\n            return a.attributes.type.localeCompare(b.attributes.type) ||\n                   a.attributes.name.localeCompare(b.attributes.name);\n        });\n    }\n\n    chalkPrint(pad=false){\n        let id = String(\"N-\" + this.id)\n        if(pad) id = id.padStart(4);\n        return chalk`{green ${id}}: {blue ${this.type}} - {green ${this.name}}`;\n    }\n}\n\ndefineAssoc(Notification, \"id\", \"data.id\");\ndefineAssoc(Notification, \"name\", \"data.attributes.name\");\ndefineAssoc(Notification, \"address\", \"data.attributes.address\");\ndefineAssoc(Notification, \"type\", \"data.attributes.type\");\ndefineAssoc(Notification, \"remote\", \"meta.remote\");\nNotification.endpoint = \"notificationPresets\"\n\nexport default Notification;\n","import {cached, defineAssoc} from \"./decorators.js\";\nimport {RallyBase, lib, Collection, AbortError} from  \"./rally-tools.js\";\nimport {configObject} from \"./config.js\";\nimport Preset from \"./preset.js\";\nimport Provider from \"./providers.js\";\nimport Notification from \"./notification.js\";\n\nimport {writeFileSync, readFileSync} from \"./fswrap.js\";\nimport {join, resolve as pathResolve} from \"path\";\n\nclass Rule extends RallyBase{\n    constructor({path, data, remote} = {}){\n        super();\n        if(path){\n            path = pathResolve(path);\n            try{\n                let f = readFileSync(path, \"utf-8\")\n                data = JSON.parse(readFileSync(path, \"utf-8\"));\n            }catch(e){\n                if(e.code === \"ENOENT\"){\n                    if(configObject.ignoreMissing){\n                        this.missing = true;\n                        return undefined;\n                    }else{\n                        throw new AbortError(\"Could not load code of local file\");\n                    }\n                }else{\n                    throw new AbortError(`Unreadable JSON in ${path}. ${e}`);\n                }\n            }\n        }\n        if(!data){\n            data = Rule.newShell();\n        }\n        this.data = data;\n        this.meta = {};\n        this.remote = remote;\n        this.isGeneric = !this.remote;\n    }\n\n    static newShell(){\n        return {\n            \"attributes\": {\n                \"description\": \"-\",\n                \"priority\": \"PriorityNorm\",\n                \"starred\": false,\n            },\n            \"relationships\": {},\n            \"type\": \"workflowRules\",\n        };\n    }\n\n    async acclimatize(env){\n        this.remote = env;\n\n        let preset  = await this.resolveField(Preset, \"preset\", false, \"specific\");\n        let pNext   = await this.resolveField(Rule, \"passNext\", false, \"specific\");\n        let eNext   = await this.resolveField(Rule, \"errorNext\", false, \"specific\");\n        let proType = await this.resolveField(Provider, \"providerType\", false, \"specific\");\n\n        let dynamicNexts = await this.resolveField(Rule, \"dynamicNexts\", true, \"specific\");\n\n        let enterNotif = await this.resolveField(Notification, \"enterNotifications\", true, \"specific\");\n        let errorNotif = await this.resolveField(Notification, \"errorNotifications\", true, \"specific\");\n        let passNotif  = await this.resolveField(Notification, \"passNotifications\", true, \"specific\");\n    }\n    async saveA(env){\n        if(lib.isLocalEnv(env)) return;\n        return await this.createIfNotExist(env);\n    }\n    async saveB(env){\n        if(!this.isGeneric){\n            await this.resolve();\n        }\n        this.cleanup();\n        if(lib.isLocalEnv(env)){\n            log(\"Writing to local path: \")\n            log(this.localpath)\n            writeFileSync(this.localpath, JSON.stringify(this.data, null, 4));\n        }else{\n            await this.acclimatize(env);\n            await this.uploadRemote(env);\n        }\n    }\n    get immutable(){\n        return false;\n    }\n    async createIfNotExist(env){\n        write(chalk`First pass rule {green ${this.name}} to {green ${env}}: `);\n\n        if(this.immutable){\n            log(chalk`{magenta IMMUTABLE}. Nothing to do.`);\n            return;\n        }\n\n        //First query the api to see if this already exists.\n        let remote = await Rule.getByName(env, this.name);\n\n        this.idMap = this.idMap || {};\n\n        if(remote){\n            this.idMap[env] = remote.id;\n            log(chalk`exists ${remote.chalkPrint(false)}`);\n            return;\n        }\n\n        //If it exists we can replace it\n        write(\"create, \");\n        let res = await lib.makeAPIRequest({\n            env, path: `/workflowRules`, method: \"POST\",\n            payload: {data: {attributes: {name: this.name}, type: \"workflowRules\"}},\n        });\n        this.idMap = this.idMap || {};\n        this.idMap[env] = res.data.id;\n        write(\"id \");\n        log(this.idMap[env]);\n    }\n\n    async patchStrip(){\n        delete this.data.attributes.createdAt;\n        delete this.data.attributes.starred;\n        delete this.data.attributes.updatedAt;\n\n        // TEMP FIX FOR BUG IN SDVI\n        if(this.relationships.passMetadata && this.relationships.passMetadata[0]){\n            log(\"HAS PASS\");\n            log(this.name);\n            log(\"HAS PASS\");\n        }\n        delete this.relationships.passMetadata;\n\n        if(this.relationships.errorMetadata && this.relationships.errorMetadata[0]){\n            log(\"HAS PASS\");\n            log(this.name);\n            log(\"HAS PASS\");\n        }\n        delete this.relationships.errorMetadata;\n\n        // This is commented out because it was fixed.\n        //for(let key in this.relationships){\n            //let relationship = this.relationships[key];\n            //if(!relationship.data || relationship.data instanceof Array && !relationship.data[0]){\n                //delete this.relationships[key];\n            //}\n        //}\n    }\n\n    async uploadRemote(env){\n        write(chalk`Uploading rule {green ${this.name}} to {green ${env}}: `);\n\n        if(this.immutable){\n            log(chalk`{magenta IMMUTABLE}. Nothing to do.`);\n            return;\n        }\n\n        if(this.idMap[env]){\n            this.remote = env;\n\n            await this.patchStrip();\n            this.data.id = this.idMap[env];\n            //If it exists we can replace it\n            write(\"replace, \");\n            let res = await lib.makeAPIRequest({\n                env, path: `/workflowRules/${this.idMap[env]}`, method: \"PATCH\",\n                payload: {data: this.data}, fullResponse: true,\n            });\n\n            log(chalk`response {yellow ${res.statusCode}}`);\n            if(res.statusCode !== 200){\n                log(res.body)\n                log(JSON.stringify(this.data, null, 4));\n            }\n        }else{\n            throw Error(\"Bad idmap!\");\n        }\n    }\n\n    get localpath(){\n        return join(configObject.repodir, \"silo-rules\", this.name + \".json\");\n    }\n\n    async resolve(){\n        let preset  = await this.resolveField(Preset, \"preset\", false);\n        //log(preset);\n        let pNext   = await this.resolveField(Rule, \"passNext\", false);\n        let eNext   = await this.resolveField(Rule, \"errorNext\", false);\n        let proType = await this.resolveField(Provider, \"providerType\", false);\n\n        //log(\"Dynamic nexts\")\n        let dynamicNexts = await this.resolveField(Rule, \"dynamicNexts\", true);\n        //log(dynamicNexts);\n\n        let enterNotif = await this.resolveField(Notification, \"enterNotifications\", true);\n        let errorNotif = await this.resolveField(Notification, \"errorNotifications\", true);\n        let passNotif  = await this.resolveField(Notification, \"passNotifications\", true);\n\n        //TODO Unsupported\n        delete this.relationships[\"enterMetadata\"]\n        delete this.relationships[\"errorMetadata\"]\n\n        this.isGeneric = true;\n\n        return {\n            preset, proType,\n            pNext, eNext,\n            dynamicNexts,\n            errorNotif, enterNotif, passNotif,\n        };\n    }\n\n    chalkPrint(pad=true){\n        let id = String(\"R-\" + (this.remote && this.remote + \"-\" + this.id || \"LOCAL\"))\n        if(pad) id = id.padStart(10);\n        try{\n            return chalk`{green ${id}}: {blue ${this.name}}`;\n        }catch(e){\n            return this.data;\n        }\n    }\n}\n\ndefineAssoc(Rule, \"name\", \"data.attributes.name\");\ndefineAssoc(Rule, \"description\", \"data.attributes.description\");\ndefineAssoc(Rule, \"id\", \"data.id\");\ndefineAssoc(Rule, \"relationships\", \"data.relationships\");\ndefineAssoc(Rule, \"isGeneric\", \"meta.isGeneric\");\ndefineAssoc(Rule, \"remote\", \"meta.remote\");\ndefineAssoc(Rule, \"idMap\", \"meta.idMap\");\nRule.endpoint = \"workflowRules\";\n\nexport default Rule;\n","import Rule from \"./rule.js\";\nimport Preset from \"./preset.js\";\nimport Provider from \"./providers.js\";\nimport Notification from \"./notification.js\";\nimport {Collection} from \"./rally-tools.js\";\nimport {configObject} from \"./config.js\";\n\nexport default class SupplyChain{\n    constructor(startingRule, stopRule){\n        if(startingRule){\n            this.startingRule = startingRule;\n            this.stopRule = stopRule\n            this.remote = startingRule.remote;\n        }\n    }\n    async calculate(){\n        log(\"Getting rules... \");\n        this.allRules = await Rule.getAll(this.remote);\n        log(this.allRules.length);\n\n        log(\"Getting presets... \");\n        this.allPresets = await Preset.getAll(this.remote);\n        log(this.allPresets.length);\n\n        log(\"Getting providers... \");\n        this.allProviders = await Provider.getAll(this.remote);\n        log(this.allProviders.length);\n\n        log(\"Getting notifications... \");\n        this.allNotifications = await Notification.getAll(this.remote);\n        log(this.allNotifications.length);\n\n        log(\"Downloading code... \");\n        let i = 0;\n        for(let preset of this.allPresets){\n            write(`\\r${\" \".repeat(process.env.COLUMNS || 30)}\\r${i++} / ${this.allPresets.arr.length} ${preset.name}`);\n            await preset.downloadCode();\n        }\n        log(\"Done!\");\n\n        //Now we have everything we need to find a whole supply chain\n\n        write(\"Calculating Supply chain... \");\n        log(this.startingRule.chalkPrint());\n\n        let allRuleNames = this.allRules.arr.map(x => x.name).filter(x => x.length >= 4);\n        let allPresetNames = this.allPresets.arr.map(x => x.name).filter(x => x.length >= 4);\n        let allNotifNames = this.allNotifications.arr.map(x => x.name).filter(x => x.length >= 4);\n        let requiredNotifications = new Set();\n\n        let ruleQueue = [this.startingRule];\n        let presetQueue = [];\n        for(let currentRule of ruleQueue){\n            if(currentRule === this.stopRule) continue;\n            let {\n                eNext, pNext, preset,\n                passNotif, errorNotif, enterNotif\n            } = await currentRule.resolve();\n\n\n            passNotif .forEach(n => requiredNotifications.add(n));\n            enterNotif.forEach(n => requiredNotifications.add(n));\n            errorNotif.forEach(n => requiredNotifications.add(n));\n\n            if(eNext && !ruleQueue.includes(eNext)) ruleQueue.push(eNext);\n            if(pNext && !ruleQueue.includes(eNext)) ruleQueue.push(pNext);\n\n            let neededPresets = preset.findStringsInCode(allPresetNames);\n            neededPresets = neededPresets.map(x => this.allPresets.findByName(x));\n\n            let neededRules = preset.findStringsInCode(allRuleNames);\n            neededRules = neededRules.map(x => this.allRules.findByName(x));\n\n            preset\n                .findStringsInCode(allNotifNames)\n                .map(str => this.allNotifications.findByName(str))\n                .forEach(notif => requiredNotifications.add(notif));\n\n            neededPresets.push(preset);\n\n            for(let p of neededPresets) if(!presetQueue.includes(p)) presetQueue.push(p);\n            for(let p of neededRules)   if(!ruleQueue  .includes(p)) ruleQueue  .push(p);\n\n            if(configObject.verbose){\n                write(currentRule.chalkPrint(false));\n                log(\":\");\n                write(\"  \");\n                write(preset.chalkPrint(false));\n                log(\":\");\n                write(\"  Pass Next: \"); if(pNext) write(pNext.chalkPrint(false)); else write(\"None\");\n                log(\"\");\n                write(\"  Err  Next: \"); if(eNext) write(eNext.chalkPrint(false)); else write(\"None\");\n                log(\"\");\n                log(\"  Rules:\");\n\n                for(let p of neededRules) log(\"    \" + p.chalkPrint(true));\n\n                log(\"  Presets:\");\n                for(let p of neededPresets) log(\"    \" + p.chalkPrint(true));\n\n                log(\"\\n\");\n            }\n        }\n\n        log(\"Done!\")\n\n        this.rules = new Collection(ruleQueue);\n        this.presets = new Collection(presetQueue);\n        requiredNotifications.delete(undefined);\n        this.notifications = new Collection([...requiredNotifications]);\n    }\n    async log(){\n        log(\"Required notifications: \");\n        this.notifications.log();\n\n        write(\"Required rules: \");\n        log(this.rules.arr.length);\n        this.rules.log();\n\n        write(\"Required presets: \");\n        log(this.presets.arr.length);\n        this.presets.log();\n    }\n    async syncTo(env){\n        for(let preset of this.presets){\n            try{\n                await preset.save(env);\n            }catch(e){log(e);}\n        }\n        if(this.rules.arr[0]){\n            log(\"Starting create phase for rules\")\n            for(let rule of this.rules){\n                try{\n                    await rule.saveA(env);\n                }catch(e){log(e);}\n            }\n\n            log(\"OK\")\n            log(\"Starting link phase for rules\");\n            Rule.removeCache(env);\n\n            for(let rule of this.rules){\n                try{\n                    await rule.saveB(env);\n                }catch(e){log(e);}\n            }\n        }\n    }\n}\n","require(\"source-map-support\").install();\n\nimport {lib} from \"./rally-tools.js\";\nimport {cached} from \"./decorators.js\";\n\nexport {default as SupplyChain} from \"./supply-chain.js\";\nexport {default as Preset} from \"./preset.js\";\nexport {default as Rule} from \"./rule.js\";\nexport {default as Provider} from \"./providers.js\";\nexport {default as Notification} from \"./notification.js\";\nexport {default as Asset} from \"./asset.js\";\n\nexport * from \"./config.js\";\n\nexport * from \"./rally-tools.js\";\n\nexport const rallyFunctions = {\n    async bestPagintation(){\n        global.silentAPI = true;\n        for(let i = 10; i <= 30; i+=5){\n            console.time(\"test with \" + i);\n            let dl = await lib.indexPathFast(\"DEV\", `/workflowRules?page=1p${i}`);\n            console.timeEnd(\"test with \" + i);\n        }\n    },\n    async uploadPresets(env, presets, createFunc = ()=>false){\n        for(let preset of presets){\n            await preset.uploadCodeToEnv(env, createFunc);\n        }\n    },\n    //Dummy test access\n    async testAccess(env){\n        if(lib.isLocalEnv(env)){\n            //TODO\n            return true;\n        }\n        let result = await lib.makeAPIRequest({env, path: \"/providers?page=1p1\", fullResponse: true, timeout: 1000});\n        return result.statusCode;\n    },\n}\n","\nexport let testCases = [\n    [\"one segment good\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"endTime\": \"00:02:37:20\",\n                        \"startTime\": \"00:01:38:10\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"00:01:39:00\",\n                                \"outPoint\": \"00:02:19:00\"\n                            }\n                        ]\n                    }\n                ],\n            }\n        }\n    }],\n    [\"out of order segment 1-2\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:59:40;00\",\n                        \"endTime\": \"00:59:59;24\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:35:00;00\",\n                        \"endTime\": \"01:40:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:00:00;00\",\n                        \"endTime\": \"01:30:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:50:00;00\",\n                        \"endTime\": \"01:59:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n    [\"bad 0 hour timecodes\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:01:00;00\",\n                        \"endTime\": \"00:02:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"00:03:00;00\",\n                        \"endTime\": \"00:04:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"00:05:00;00\",\n                        \"endTime\": \"00:06:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n    [\"bad ovelapping segments\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:59:40;00\",\n                        \"endTime\": \"00:59:59;24\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:00:00;00\",\n                        \"endTime\": \"01:30:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:20:00;00\",\n                        \"endTime\": \"01:40:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:50:00;00\",\n                        \"endTime\": \"01:59:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n    [\"good segments\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:59:40;00\",\n                        \"endTime\": \"00:59:59;24\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:00:00;00\",\n                        \"endTime\": \"01:30:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:35:00;00\",\n                        \"endTime\": \"01:40:37;20\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:50:00;00\",\n                        \"endTime\": \"01:59:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n    [\"good segments w/ good woos\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:59:40;00\",\n                        \"endTime\": \"00:59:59;24\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:00:00;00\",\n                        \"endTime\": \"01:30:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:20:39;00\",\n                                \"outPoint\": \"01:21:49;00\"\n                            }\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:35:00;00\",\n                        \"endTime\": \"01:40:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:36:39;00\",\n                                \"outPoint\": \"01:37:49;00\"\n                            }\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:50:00;00\",\n                        \"endTime\": \"01:59:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n    [\"good segments w/ good woos (multiple woos]\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:59:40;00\",\n                        \"endTime\": \"00:59:59;24\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:00:00;00\",\n                        \"endTime\": \"01:30:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:20:39;00\",\n                                \"outPoint\": \"01:21:49;00\"\n                            },\n                            {\n                                \"inPoint\": \"01:22:39;00\",\n                                \"outPoint\": \"01:23:49;00\"\n                            }\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:35:00;00\",\n                        \"endTime\": \"01:40:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:36:39;00\",\n                                \"outPoint\": \"01:37:49;00\"\n                            },\n                            {\n                                \"inPoint\": \"01:38:39;00\",\n                                \"outPoint\": \"01:40:37;20\"\n                            }\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:50:00;00\",\n                        \"endTime\": \"01:59:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n    [\"good segments w/ bad woos (fully outside segment]\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:59:40;00\",\n                        \"endTime\": \"00:59:59;24\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:00:00;00\",\n                        \"endTime\": \"01:30:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:33:39;00\",\n                                \"outPoint\": \"01:35:49;00\"\n                            },\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:35:00;00\",\n                        \"endTime\": \"01:40:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:36:39;00\",\n                                \"outPoint\": \"01:37:49;00\"\n                            },\n                            {\n                                \"inPoint\": \"01:38:39;00\",\n                                \"outPoint\": \"01:40:37;20\"\n                            }\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:50:00;00\",\n                        \"endTime\": \"01:59:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n    [\"good segments w/ bad woos (go past segment out time]\", {\n        \"userMetaData\": {\n            \"segments\": {\n                \"segments\": [\n                    {\n                        \"startTime\": \"00:59:40;00\",\n                        \"endTime\": \"00:59:59;24\",\n                        \"woo\": [ ]\n                    },\n                    {\n                        \"startTime\": \"01:00:00;00\",\n                        \"endTime\": \"01:30:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:20:39;00\",\n                                \"outPoint\": \"01:31:49;00\"\n                            },\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:35:00;00\",\n                        \"endTime\": \"01:40:37;20\",\n                        \"woo\": [\n                            {\n                                \"inPoint\": \"01:36:39;00\",\n                                \"outPoint\": \"01:37:49;00\"\n                            },\n                            {\n                                \"inPoint\": \"01:38:39;00\",\n                                \"outPoint\": \"01:40:37;20\"\n                            }\n                        ]\n                    },\n                    {\n                        \"startTime\": \"01:50:00;00\",\n                        \"endTime\": \"01:59:00;00\",\n                        \"woo\": [ ]\n                    },\n                ],\n            }\n        }\n    }],\n];\n\nimport Asset from \"./asset.js\";\n\nfunction recursivePatch(target, patch){\n    if(typeof patch !== \"object\" || Array.isArray(patch)) return patch;\n    for(let [key, value] of Object.entries(patch)){\n        if(typeof value === \"object\"){\n            target[key] = recursivePatch(target[key], value);\n        }else{\n            target[key] = value;\n        }\n    }\n    return target;\n}\n\nexport async function testFunction(args){\n    function uuid(args){\n        const digits = 16;\n        return String(Math.floor(Math.random() * Math.pow(10, digits))).padStart(digits, \"0\");\n    }\n\n    let json = JSON.parse(require(\"fs\").readFileSync(\"recontribution_init.json\"));\n\n    for(let [name, patch] of testCases){\n        let base = JSON.parse(JSON.stringify(json));\n        base[\"Metadata\"] = recursivePatch(base[\"Metadata\"], patch);\n\n        let asset = await Asset.createNew(\"USKN_R_\" + uuid(), \"UAT\");\n        log(name);\n        log(asset.data.links.self.replace(\"/api/v2/assets/\", \"/content/\"));\n        await asset.addFile(\"SdviMovieFileMaster\", \"s3://discovery.com.uat.onramp.archive.us-east-1/DKNOXR_Master2.mxf\");\n        await asset.startWorkflow(\"External Logging\", {\n            version: 1,\n            message: `Test: ${name}`,\n        });\n        await asset.startWorkflow(\"AS302 Test DKNOX Recontribution\", base);\n    }\n}\n","export default {\n    SdviContentMover:`{\n    \"tasks\": [\n        {\n            \"operation\": \"move\",\n            \"source\": {\n                \"labels\": [ \"MyLabel\" ],\n                \"tags\": [ \"segmented\" ]\n                \"storageSet\": [ \"*\", \"-OtherStorageBucket\" ],\n\n            },\n            \"destination\": {\n                \"storage\": \"Archive\",\n                \"newLabel\": \"myNewLabel\",\n                \"overwrite\": \"always\"\n            }\n        }\n    ]\n}`, SdviEvaluate: `'''\nname: {name}\n'''\n\n# code here`,\n};\n","import {configObject} from \"./config.js\";\nimport {join} from \"path\";\nimport Preset from \"./preset.js\";\nimport Rule from \"./rule.js\";\nexport const inquirer = importLazy(\"inquirer\");\nconst readdir = importLazy(\"recursive-readdir\");\n\nlet hasAutoCompletePrompt = false;\nexport function addAutoCompletePrompt(){\n    if(hasAutoCompletePrompt) return\n    hasAutoCompletePrompt = true;\n    inquirer.registerPrompt(\"autocomplete\", require(\"inquirer-autocomplete-prompt\"));\n}\n\nexport async function $api(propArray){\n    const defaults = {\n        DEV:  \"https://discovery-dev.sdvi.com/api/v2\",\n        UAT:  \"https://discovery-uat.sdvi.com/api/v2\",\n        QA:  \"https://discovery-qa.sdvi.com/api/v2\",\n        PROD: \"https://discovery.sdvi.com/api/v2\",\n    };\n\n    let q;\n    if(propArray && propArray[1]){\n        q = {envs: [propArray[1]]};\n    }else{\n        //Create a checkbox prompt to choose enviornments\n        q = await inquirer.prompt([{\n            type: \"checkbox\",\n            name: \"envs\",\n            message: `What enviornments would you like to configure?`,\n            choices: Object.keys(defaults).map(name => ({name, checked:true})),\n        }]);\n    }\n\n    //Each env should ask 2 for two things: The url and the key.\n    let questions = q.envs.map(env => {\n        let defaultKey = process.env[`rally_api_key_${env}`];\n        if(configObject && configObject.api && configObject.api[env]){\n            defaultKey = configObject.api[env].key;\n        }\n\n        return [{\n            type: \"input\",\n            name: `api.${env}.url`,\n            message: `What is the url endpoint for ${env}`,\n            default: defaults[env],\n        }, {\n            type: \"input\",\n            name: `api.${env}.key`,\n            message: `What is your api key for ${env}`,\n            default: defaultKey,\n        }];\n    });\n\n    //flatten and ask\n    questions = [].concat(...questions);\n    q = await inquirer.prompt(questions);\n    if(propArray){\n        q.api = {...configObject.api, ...q.api};\n    }\n    return q;\n}\nexport async function $chalk(propArray){\n    return {chalk: await askQuestion(\"Would you like chalk enabled (Adds coloring)?\")};\n}\nexport async function $restrictUAT(propArray){\n    return {restrictUAT: await askQuestion(\"Would you like to protect UAT?\")};\n}\nexport async function $repodir(propArray){\n    return await inquirer.prompt([{\n        type: \"input\",\n        name: `repodir`,\n        message: `Where is your rally repository?`,\n        default: process.env[\"rally_repo_path\"],\n    }]);\n}\n\nexport async function $defaultEnv(propArray){\n    return await inquirer.prompt([{\n        type: \"input\",\n        name: `defaultEnv`,\n        message: `Default enviornment?`,\n        default: \"DEV\",\n    }]);\n}\n\n//Internal usage/testing\nexport async function selectProvider(providers, autoDefault = false){\n    addAutoCompletePrompt();\n    let defaultProvider = providers.findByName(\"SdviEvaluate\");\n    if(autoDefault){\n        return defaultProvider;\n    }else{\n        let choices = providers.arr.map(x => ({\n            name: x.chalkPrint(true),\n            value: x,\n        }))\n        let q = await inquirer.prompt([{\n            type: \"autocomplete\",\n            name: \"provider\",\n            default: defaultProvider,\n            source: async (sofar, input) => {\n                return choices.filter(x => input ? x.value.name.toLowerCase().includes(input.toLowerCase()) : true);\n            },\n        }]);\n        return q.provider;\n    }\n}\n\nexport async function selectLocal(path, typeName, Class){\n    addAutoCompletePrompt();\n    let basePath = join(configObject.repodir, path)\n    let f = await readdir(basePath);\n    let objs = f.map(name => new Class({path: name}));\n    let objsMap = objs.map(x => ({\n        name: x.chalkPrint(true),\n        value: x,\n    }));\n    let none = {\n        name: (chalk`      {red None}: {red None}`),\n        value: null,\n    };\n    objsMap.unshift(none);\n\n    let q = await inquirer.prompt([{\n        type: \"autocomplete\",\n        name: \"obj\",\n        message: `What ${typeName} do you want?`,\n        source: async (sofar, input) => {\n            return objsMap.filter(x => input ? x.name.toLowerCase().includes(input.toLowerCase()) : true);\n        },\n    }]);\n    return q.obj;\n}\n\nexport async function selectPreset(purpose = \"preset\"){\n    return selectLocal(\"silo-presets\", \"preset\", Preset);\n}\nexport async function selectRule(purpose = \"rule\"){\n    return selectLocal(\"silo-rules\", purpose, Rule);\n}\n\nexport async function askInput(name, question, def){\n    return (await inquirer.prompt([{\n        type: \"input\",\n        name: \"ok\",\n        message: question,\n        default: def,\n    }])).ok;\n}\n\nexport async function askQuestion(question){\n    return (await inquirer.prompt([{\n        type: \"confirm\",\n        name: \"ok\",\n        message: question,\n    }])).ok;\n}\n","require(\"source-map-support\").install();\n\nimport argparse from \"minimist\";\nimport * as allIndexBundle from \"./index.js\"\nimport {\n    rallyFunctions as funcs,\n    Preset, Rule, SupplyChain, Provider, Asset,\n    AbortError, UnconfiguredEnvError, Collection, APIError\n} from \"./index.js\";\n\nimport {version as packageVersion} from \"../package.json\";\nimport {configFile, configObject, loadConfig} from \"./config.js\";\nimport {readFileSync, writeFileSync} from \"fs\";\n\nimport {helpText, arg, param, usage, helpEntries, spawn} from \"./decorators.js\";\n\nimport {testFunction} from \"./unitTestRally.js\";\n\nimport baseCode from \"./baseCode.js\";\n\nimport * as configHelpers from \"./config-create.js\";\nconst False = false; const True = true; const None = null;\n\nlet argv = argparse(process.argv.slice(2), {\n    string: [\"file\", \"env\"],\n    //boolean: [\"no-protect\"],\n    default: {protect: true},\n    alias: {\n        f: \"file\", e: \"env\",\n    }\n});\n\n//help menu helper\nfunction printHelp(help, short){\n    let helpText = chalk`\n{white ${help.name}}: ${help.text}\n    Usage: ${help.usage || \"<unknown>\"}\n`\n    //Trim newlines\n    helpText = helpText.substring(1, helpText.length-1);\n\n    if(!short){\n        for(let param of help.params || []){\n            helpText += chalk`\\n    {blue ${param.param}}: ${param.desc}`\n        }\n        for(let arg of help.args || []){\n            helpText += chalk`\\n    {blue ${arg.short}}, {blue ${arg.long}}: ${arg.desc}`\n        }\n    }\n\n    return helpText;\n}\n\nasync function getFilesFromArgs(args){\n    let lastArg = args._.shift()\n    if(args.file){\n        let files = args.file;\n        if(typeof files === \"string\") files = [files];\n        return files;\n    }\n\n    if(lastArg == \"-\"){\n        log(\"Reading from stdin\");\n        let getStdin = require(\"get-stdin\");\n        let stdin = await getStdin();\n        let files  = stdin.split(\"\\n\");\n        if(files[files.length - 1] === \"\") files.pop();\n        return files;\n    }else{\n        args._.push(lastArg);\n    }\n}\n\nlet presetsub = {\n    async before(args){\n        this.env = args.env;\n        if(!this.env) throw new AbortError(\"No env supplied\");\n\n        this.files = await getFilesFromArgs(args);\n    },\n    async $grab(args){\n        if(!this.files){\n            throw new AbortError(\"No files provided to grab (use --file argument)\");\n        }\n\n        log(chalk`Grabbing {green ${this.files.length}} preset(s) metadata from {green ${this.env}}.`);\n\n        let presets = this.files.map(path => new Preset({path, remote: false}));\n        for(let preset of presets){\n            //TODO small refactor\n            await preset.grabMetadata(this.env);\n            await preset.saveLocalMetadata();\n\n            if(args.full){\n                let remo = await Preset.getByName(this.env, preset.name);\n                await remo.resolve();\n                await remo.downloadCode();\n                await remo.saveLocalFile();\n            }\n        }\n    },\n    async $create(args){\n        let provider, name, ext;\n        if(args.provider){\n            provider = {name: args.provider};\n            ext = args.ext\n        }else{\n            provider = await configHelpers.selectProvider(await Provider.getAll(this.env));\n            ext = (await provider.getEditorConfig()).fileExt;\n        }\n        if(args.name){\n            name = args.name;\n        }else{\n            name = await configHelpers.askInput(\"Preset Name\", \"What is the preset name?\");\n        }\n\n        let preset = new Preset();\n\n        preset.providerType = {name: provider.name};\n        preset.isGeneric = true;\n        preset.name = name;\n        preset.ext = ext;\n        if(baseCode[provider.name]){\n            preset._code = baseCode[provider.name].replace(\"{name}\", name);\n        }else{\n            preset._code = \" \";\n        }\n\n        preset.saveLocalMetadata();\n        preset.saveLocalFile();\n    },\n    async $list(args){\n        log(\"Loading...\");\n        let presets = await Preset.getAll(this.env);\n        if(args.resolve){\n            Provider.getAll(this.env);\n            for(let preset of presets){\n                let resolve = await preset.resolve(this.env);\n                if(args.attach){\n                    let {proType} = resolve;\n                    proType.editorConfig.helpText = \"\";\n                    preset.meta = {\n                        ...preset.meta, proType\n                    };\n                }\n            }\n        }\n        if(configObject.rawOutput) return presets;\n        log(chalk`{yellow ${presets.length}} presets on {green ${this.env}}.`);\n        presets.arr.sort((a, b) => {\n            return Number(a.attributes.updatedAt) - Number(b.attributes.updatedAt)\n        });\n        for(let preset of presets){\n            log(preset.chalkPrint());\n        }\n    },\n    async $upload(args){\n        if(!this.files){\n            throw new AbortError(\"No files provided to upload (use --file argument)\");\n        }\n\n        log(chalk`Uploading {green ${this.files.length}} preset(s) to {green ${this.env}}.`);\n\n        let presets = this.files.map(path => new Preset({path, remote: false}));\n        await funcs.uploadPresets(this.env, presets);\n    },\n    async $diff(args){\n        let file = this.files[0];\n        if(!this.files){\n            throw new AbortError(\"No files provided to diff (use --file argument)\");\n        }\n\n        let preset = new Preset({path: file, remote: false});\n        if(!preset.name){\n            throw new AbortError(chalk`No preset header found. Cannot get name.`);\n        }\n        let preset2 = await Preset.getByName(this.env, preset.name);\n        if(!preset2){\n            throw new AbortError(chalk`No preset found with name {red ${preset.name}} on {blue ${this.env}}`);\n        }\n        await preset2.downloadCode();\n\n        let tempfile = require(\"tempy\").file;\n        let temp = tempfile({extension: `${this.env}.${preset.ext}`});\n        writeFileSync(temp, preset2.code);\n\n        let ptr = `${file},${temp}`;\n\n\n        //raw output returns \"file1\" \"file2\"\n        if(configObject.rawOutput){\n            if(args[\"only-new\"]) return temp;\n            else return ptr;\n        }\n\n        //standard diff\n        argv.command = argv.command || \"diff\";\n        await spawn(argv.command, [file, temp], {stdio: \"inherit\"});\n    },\n    async unknown(arg, args){\n        log(chalk`Unknown action {red ${arg}} try '{white rally help preset}'`);\n    },\n}\n\nlet rulesub = {\n    async before(args){\n        this.env = args.env;\n        if(!this.env) throw new AbortError(\"No env supplied\");\n    },\n    async $list(args){\n        log(\"Loading...\");\n        let rules = await Rule.getAll(this.env);\n        if(configObject.rawOutput) return rules;\n\n        log(chalk`{yellow ${rules.length}} rules on {green ${this.env}}.`);\n        rules.arr.sort((a, b) => {\n            return Number(a.data.attributes.updatedAt) - Number(b.data.attributes.updatedAt)\n        });\n        for(let rule of rules) log(rule.chalkPrint());\n    },\n    async $create(args){\n        let preset = await configHelpers.selectPreset();\n        let passNext = await configHelpers.selectRule(\"'On Exit OK'\");\n        let errorNext = await configHelpers.selectRule(\"'On Exit Error'\");\n        let name = await configHelpers.askInput(\"Rule Name\", \"What is the rule name?\");\n        let desc = await configHelpers.askInput(\"Description\", \"Enter a description.\");\n\n        let dynamicNexts = [];\n        let next;\n        while(next = await configHelpers.selectRule(\"dynamic next\")){\n            let name = await configHelpers.askInput(\"Key\", \"Key name for dynamic next\");\n            dynamicNexts.push({\n                meta: {\n                    transition: name,\n                },\n                type: \"workflowRules\",\n                name: next.name,\n            });\n        }\n\n        let rule = new Rule();\n        rule.name = name;\n        rule.description = desc;\n        rule.relationships.preset = {data: {name: preset.name, type: \"presets\"}}\n        if(errorNext) rule.relationships.errorNext = {data: {name: errorNext.name, type: \"workflowRules\"}}\n        if(passNext) rule.relationships.passNext = {data: {name: passNext.name, type: \"workflowRules\"}}\n        if(dynamicNexts[0]){\n            rule.relationships.dynamicNexts = {\n                data: dynamicNexts\n            };\n        }\n\n        rule.saveB()\n    },\n    async unknown(arg, args){\n        log(chalk`Unknown action {red ${arg}} try '{white rally help rule}'`);\n    },\n}\n\nlet jupytersub = {\n    async before(args){\n        this.input = args._.shift() || \"main.ipynb\";\n        this.output = args._.shift() || \"main.py\";\n    },\n    async $build(args){\n        let cmd = `jupyter nbconvert --to python ${this.input} --TagRemovePreprocessor.remove_cell_tags={\\\"remove_cell\\\"} --output ${this.output} --TemplateExporter.exclude_markdown=True --TemplateExporter.exclude_input_prompt=True --TemplateExporter.exclude_output_prompt=True`.split(\" \");\n        log(chalk`Compiling GCR file {green ${this.input}} into {green ${this.output}} using jupyter...`);\n\n        try{\n            let {timestr} = await spawn(cmd[0], cmd.slice(1));\n            log(chalk`Complete in ~{green.bold ${timestr}}.`);\n        }catch(e){\n            if(e.code !== \"ENOENT\") throw e;\n            log(chalk`Cannot run the build command. Make sure that you have jupyter notebook installed.\\n{green pip install jupyter}`);\n            return;\n        }\n    },\n}\n\nasync function categorizeString(str){\n    str = str.trim();\n    let match\n    if(match = /^(\\w)-(\\w{1,10})-(\\d{1,10}):/.exec(str)){\n        if(match[1] === \"P\"){\n            return await Preset.getById(match[2], match[3]);\n        }else if(match[1] === \"R\"){\n            return await Rule.getById(match[2], match[3]);\n        }else{\n            return null;\n        }\n    }else if(match = /silo\\-(\\w+)\\//.exec(str)){\n        try{\n            switch(match[1]){\n                case \"presets\": return new Preset({path: str});\n                case \"rules\": return new Rule({path: str});\n                case \"metadata\": return await Preset.fromMetadata(str);\n            }\n        }catch(e){\n            log(e);\n        }\n    }else{\n        return null;\n    }\n}\n\nlet supplysub = {\n    async before(args){\n        this.env = args.env;\n        if(!this.env) throw new AbortError(\"No env supplied\");\n        this.files = await getFilesFromArgs(args);\n    },\n\n    //Calculate a supply chain based on a starting rule at the top of the stack\n    async $calc(args){\n        let name = args._.shift();\n        let stopName = args._.shift();\n        if(!name){\n            throw new AbortError(\"No starting rule supplied\");\n        }\n\n        let rules = await Rule.getAll(this.env);\n        let start = rules.findByNameContains(name);\n        let stop;\n        if(stopName) stop = rules.findByNameContains(stopName);\n\n        if(!start){\n            throw new AbortError(chalk`No starting rule found by name {blue ${name}}`);\n        }\n\n        log(chalk`Analzying supply chain: ${start.chalkPrint(false)} - ${stop ? stop.chalkPrint(false) : \"(open)\"}`);\n\n        this.chain = new SupplyChain(start, stop);\n        await this.chain.calculate();\n        await this.postAction(args);\n    },\n    async postAction(args){\n        //Now that we ahve a supply chain object, do something with it\n        if(args[\"to\"]){\n            this.chain.log();\n            if(this.chain.presets.arr[0]){\n                log(\"Loading code\");\n                for(let preset of this.chain.presets){\n                    await preset.downloadCode();\n                }\n                log(\"Done\");\n            }\n\n            if(Array.isArray(args[\"to\"])){\n                for(let to of args[\"to\"]){\n                    await this.chain.syncTo(to);\n                }\n            }else{\n                await this.chain.syncTo(args[\"to\"]);\n            }\n        }else if(args[\"diff\"]){\n            //Very basic diff\n            let env = args[\"diff\"];\n            await Promise.all(this.chain.presets.arr.map(obj => obj.downloadCode()));\n            await Promise.all(this.chain.presets.arr.map(obj => obj.resolve()));\n\n            let otherPresets = await Promise.all(this.chain.presets.arr.map(obj => Preset.getByName(env, obj.name)));\n            otherPresets = new Collection(otherPresets.filter(x => x));\n            await Promise.all(otherPresets.arr.map(obj => obj.downloadCode()));\n            await Promise.all(otherPresets.arr.map(obj => obj.resolve()));\n\n            const printPresets = (preset, otherPreset) => {\n                log(preset.chalkPrint(true));\n                if(otherPreset.name){\n                    log(otherPreset.chalkPrint(true));\n                }else{\n                    log(chalk`{red (None)}`);\n                }\n            }\n\n            for(let preset of this.chain.presets){\n                let otherPreset = otherPresets.arr.find(x => x.name === preset.name) || {};\n\n                if(preset.code === otherPreset.code){\n                    if(!args[\"ignore-same\"]){\n                        printPresets(preset, otherPreset);\n                        log(\"Code Same\");\n                    }\n                }else{\n                    printPresets(preset, otherPreset);\n                    if(args[\"ignore-same\"]){\n                        log(\"-------\");\n                    }else{\n                        log(\"Code Different\");\n                    }\n                }\n            }\n\n        }else{\n            await this.chain.log();\n        }\n\n    },\n    async $make(args){\n        let set = new Set();\n        for(let file of this.files){\n            set.add(await categorizeString(file));\n        }\n        let files = [...set];\n        files = files.filter(f => f && !f.missing);\n        this.chain = new SupplyChain();\n\n        this.chain.rules = new Collection(files.filter(f => f instanceof Rule));\n        this.chain.presets = new Collection(files.filter(f => f instanceof Preset));\n        this.chain.notifications = new Collection([]);\n\n        await this.postAction(args);\n    },\n    async unknown(arg, args){\n        log(chalk`Unknown action {red ${arg}} try '{white rally help supply}'`);\n    },\n}\n\nfunction subCommand(object){\n    object = {\n        before(){}, after(){}, unknown(){},\n        ...object\n    };\n    return async function(args){\n        //Grab the next arg on the stack, find a function tied to it, and run\n        let arg = args._.shift();\n        let key = \"$\" + arg;\n        let ret;\n        if(object[key]){\n            await object.before(args);\n            ret = await object[key](args);\n            await object.after(args);\n        }else{\n            if(arg === undefined) arg = \"(None)\";\n            object.unknown(arg, args);\n        }\n        return ret;\n    }\n}\n\nlet cli = {\n    @helpText(`Display the help menu`)\n    @usage(`rally help [subhelp]`)\n    @param(\"subhelp\", \"The name of the command to see help for\")\n    async help(args){\n        let arg = args._.shift();\n        if(arg){\n            let help = helpEntries[arg];\n            if(!help){\n                log(chalk`No help found for '{red ${arg}}'`);\n            }else{\n                log(printHelp(helpEntries[arg]));\n            }\n        }else{\n            for(let helpArg in helpEntries){\n                log(printHelp(helpEntries[helpArg], true));\n            }\n        }\n    },\n\n    @helpText(\"Rally tools jupyter interface. Requires jupyter to be installed.\")\n    @usage(\"rally jupyter build [in] [out]\")\n    @param(\"in/out\", \"input and output file for jupyter. By default main.ipyrb and main.py\")\n    async jupyter(args){\n        return subCommand(jupytersub)(args);\n    },\n\n    //@helpText(`Print input args, for debugging`)\n    async printArgs(args){\n        log(args);\n    },\n\n    @helpText(`Preset related actions`)\n    @usage(`rally preset [action] --env <enviornment> --file [file1] --file [file2] ...`)\n    @param(\"action\", \"The action to perform. Can be upload, diff, list\")\n    @arg(\"-e\", \"--env\", \"The enviornment you wish to perform the action on\")\n    @arg(\"-f\", \"--file\", \"A file to act on\")\n    @arg(\"~\", \"--command\", \"If the action is diff, this is the command to run instead of diff\")\n    async preset(args){\n        return subCommand(presetsub)(args);\n    },\n\n    @helpText(`Rule related actions`)\n    @usage(`rally rule [action] --env [enviornment]`)\n    @param(\"action\", \"The action to perform. Only list is supported right now\")\n    @arg(\"-e\", \"--env\", \"The enviornment you wish to perform the action on\")\n    async rule(args){\n        return subCommand(rulesub)(args);\n    },\n\n    @helpText(`supply chain related actions`)\n    @usage(`rally supply [action] [identifier] --env [enviornment]`)\n    @param(\"action\", \"The action to perform. Can be calc.\")\n    @param(\"identifier\", \"If the action is calc, then this identifier should be the first rule in the chain.\")\n    @arg(\"-e\", \"--env\", \"The enviornment you wish to perform the action on\")\n    async supply(args){\n        return subCommand(supplysub)(args);\n    },\n\n    @helpText(`List all available providers, or find one by name/id`)\n    @usage(`rally providers [identifier] --env [env] --raw`)\n    @param(\"identifier\", \"Either the name or id of the provider\")\n    @arg(\"-e\", \"--env\", \"The enviornment you wish to perform the action on\")\n    @arg(\"~\", \"--raw\", \"Raw output of command. If [identifier] is given, then print editorConfig too\")\n    async providers(args){\n        let env = args.env;\n        if(!env) return errorLog(\"No env supplied.\");\n        let ident = args._.shift();\n\n        let providers = await Provider.getAll(env);\n\n        if(ident){\n            let pro = providers.arr.find(x => x.id == ident || x.name.includes(ident));\n            if(!pro){\n                log(chalk`Couldn't find provider by {green ${ident}}`);\n            }else{\n                log(pro.chalkPrint(false));\n                let econfig = await pro.getEditorConfig();\n                if(args.raw){\n                    return pro;\n                }else{\n                    if(econfig.helpText.length > 100){\n                        econfig.helpText = \"<too long to display>\";\n                    }\n                    if(econfig.completions.length > 5){\n                        econfig.completions = \"<too long to display>\";\n                    }\n                    log(econfig);\n                }\n            }\n        }else{\n            if(args.raw) return providers;\n            for(let pro of providers) log(pro.chalkPrint());\n        }\n    },\n\n    @helpText(`Change config for rally tools`)\n    @usage(\"rally config [key] --set [value] --raw\")\n    @param(\"key\", chalk`Key you want to edit. For example, {green chalk} or {green api.DEV}`)\n    @arg(\"~\", \"--set\", \"If this value is given, no interactive prompt will launch and the config option will change.\")\n    @arg(\"~\", \"--raw\", \"Raw output of json config\")\n    async config(args){\n        let prop = args._.shift();\n        let propArray = prop && prop.split(\".\");\n\n        //if(!await configHelpers.askQuestion(`Would you like to create a new config file in ${configFile}`)) return;\n        let newConfigObject;\n\n        if(!prop){\n            if(configObject.rawOutput) return configObject;\n            log(\"Creating new config\");\n            newConfigObject = {\n                ...configObject,\n            };\n            for(let helperName in configHelpers){\n                if(helperName.startsWith(\"$\")){\n                    newConfigObject = {\n                        ...newConfigObject,\n                        ...(await configHelpers[helperName](false))\n                    }\n                }\n            }\n        }else{\n            log(chalk`Editing option {green ${prop}}`);\n            if(args.set){\n                newConfigObject = {\n                    ...configObject,\n                    [prop]: args.set,\n                };\n            }else{\n                let ident = \"$\" + propArray[0];\n\n                if(configHelpers[ident]){\n                    newConfigObject = {\n                        ...configObject,\n                        ...(await configHelpers[ident](propArray))\n                    };\n                }else{\n                    log(chalk`No helper for {red ${ident}}`);\n                    return;\n                }\n            }\n        }\n\n        newConfigObject.hasConfig = true;\n\n        //Create readable json and make sure the user is ok with it\n        let newConfig = JSON.stringify(newConfigObject, null, 4);\n        log(newConfig);\n\n        //-y or --set will make this not prompt\n        if(!args.y && !args.set && !await configHelpers.askQuestion(\"Write this config to disk?\")) return;\n        writeFileSync(configFile, newConfig, {mode: 0o600});\n        log(chalk`Created file {green ${configFile}}.`);\n    },\n\n    @helpText(`create/modify asset`)\n    @usage(\"rally asset [action] [action...]\")\n    @param(\"action\", chalk`Options are create, delete, launch, addfile. You can supply multiple actions to chain them`)\n    @arg(`-i`, `--id`,         chalk`MOVIE_ID of asset to select`)\n    @arg(`-n`, `--name`,       chalk`MOVIE_NAME of asset. with {white create}, '{white #}' will be replaced with a uuid. Default is '{white TEST_#}'`)\n    @arg(`-j`, `--job-name`,   chalk`Job name to start (used with launch)`)\n    @arg(`~`,  `--init-data`,  chalk`Init data to use when launching job. can be string, or {white @path/to/file} for a file`)\n    @arg(`~`,  `--file-label`, chalk`File label (used with addfile)`)\n    @arg(`~`,  `--file-uri`,   chalk`File s3 uri. Can use multiple uri's for the same label (used with addfile)`)\n    async asset(args){\n        function uuid(args){\n            const digits = 16;\n            return String(Math.floor(Math.random() * Math.pow(10, digits))).padStart(digits, \"0\");\n        }\n\n        let name = args.name || `TEST_#`;\n        let env = args.env;\n\n        let asset;\n        let arg = args._.shift()\n        if(!arg){\n            throw new AbortError(chalk`Missing arguments: see {white 'rally help asset'}`);\n        }\n\n        if(arg == \"create\"){\n            name = name.replace(\"#\", uuid());\n            asset = await Asset.createNew(name, env);\n        }else{\n            args._.unshift(arg);\n            if(args.id){\n                asset = Asset.lite(args.id, env);\n            }else{\n                asset = await Asset.getByName(env, args.name);\n            }\n        }\n\n        if(!asset){\n            throw new AbortError(\"No asset found/created\");\n        }\n\n        while(arg = args._.shift()){\n            if(arg === \"launch\"){\n                let initData = args[\"init-data\"];\n                if(initData && initData.startsWith(\"@\")){\n                    log(chalk`Reading init data from {white ${initData.slice(1)}}`);\n                    initData = readFileSync(initData.slice(1), \"utf-8\");\n                }\n\n                let jobName = args[\"job-name\"];\n                let p = await Rule.getByName(env, jobName);\n                if(!p){\n                    throw new AbortError(`Cannot launch job ${jobName}, does not exist (?)`);\n                }else{\n                    log(chalk`Launching ${p.chalkPrint(false)} on ${asset.chalkPrint(false)}`);\n                }\n\n                asset.startWorkflow(jobName, initData)\n            }else if(arg === \"addfile\"){\n                await asset.addFile(args[\"file-label\"], args[\"file-uri\"]);\n            }else if(arg === \"delete\"){\n                await asset.delete();\n            }else if(arg === \"create\"){\n                throw new AbortError(`Cannot have more than 1 create/get per asset call`);\n            }else if(arg === \"show\"){\n                log(asset);\n            }\n        }\n    },\n\n    async checkSegments(args){\n        let asset = args._.shift()\n        let res = await allIndexBundle.lib.makeAPIRequest({\n            env: args.env, path: `/movies/${asset}/metadata/Metadata`,\n        });\n        let segments = res.data.attributes.metadata.userMetaData.segments.segments;\n\n        let r = segments.reduce((lastSegment, val, ind) => {\n            let curSegment = val.startTime;\n            if(curSegment < lastSegment){\n                log(\"bad segment \" + (ind + 1))\n            }\n            return val.endTime\n         }, \"00:00:00:00\");\n    },\n\n    async replaceItem(args){\n    },\n\n    async unitTest(args){\n        await testFunction(args);\n    },\n\n    async findLeslie(args){\n        let allLesieLike = [\n            ...(await this.listAssets(args, \"HGTV\")),\n\n            ...(await this.listAssets(args, \"GAC\")),\n            ...(await this.listAssets(args, \"Great American Country\")),\n\n            ...(await this.listAssets(args, \"COOK\")),\n            ...(await this.listAssets(args, \"Cooking Channel\")),\n\n            ...(await this.listAssets(args, \"TRAV\")),\n            ...(await this.listAssets(args, \"Travel Channel\")),\n\n            ...(await this.listAssets(args, \"DIY\")),\n            ...(await this.listAssets(args, \"DIY Network\")),\n\n            ...(await this.listAssets(args, \"FOOD\")),\n            ...(await this.listAssets(args, \"Food Network\")),\n        ];\n\n        return allLesieLike;\n    },\n\n    async listAssets(args, tag){\n        let req = await allIndexBundle.lib.indexPathFast({\n            env: args.env, path: \"/assets\",\n            qs: {\n                noRelationships: true,\n                sort: \"id\",\n            },\n            chunksize: 30,\n        });\n        for(let asset of req){\n            log(asset.id);\n        }\n\n        return req;\n    },\n\n    async listSegments(args){\n        let f = JSON.parse(readFileSync(args.file, \"utf-8\"));\n\n        for(let asset of f){\n            let r = await allIndexBundle.lib.makeAPIRequest({\n                env: args.env, path: `/movies/${asset.id}/metadata/Metadata`,\n            });\n\n            let segs = r.data.attributes.metadata.userMetaData?.segments?.segments;\n            if(segs && segs.length > 1){\n                log(asset.id);\n                log(asset.name);\n            }\n        }\n    },\n    async test2(args){\n        let wfr = await allIndexBundle.lib.indexPath({\n            env: args.env, path: \"/workflowRuleMetadata\",\n        });\n        log(wfr);\n\n        for(let wfrm of wfr){\n            try{\n                wfrm.id = undefined;\n                wfrm.links = undefined;\n                log(wfrm);\n                let req = await allIndexBundle.lib.makeAPIRequest({\n                    env: \"DEV\", path: \"/workflowRuleMetadata\",\n                    method: \"POST\",\n                    payload: {data: wfrm},\n                })\n            }catch(e){\n                log(\"caught\");\n            }\n            //break;\n        }\n    },\n\n    async test3(args){\n        let wfr = await allIndexBundle.lib.indexPath({\n            env: args.env, path: \"/workflowRuleMetadata\",\n        });\n        log(wfr);\n\n        for(let wfrm of wfr){\n            try{\n                wfrm.id = undefined;\n                wfrm.links = undefined;\n                log(wfrm);\n                let req = await allIndexBundle.lib.makeAPIRequest({\n                    env: \"DEV\", path: \"/workflowRuleMetadata\",\n                    method: \"POST\",\n                    payload: {data: wfrm},\n                })\n            }catch(e){\n                log(\"caught\");\n            }\n            //break;\n        }\n    },\n\n    sleep(time = 1000){\n        return new Promise(resolve => setTimeout(resolve, time));\n    },\n\n    async getAssets(env, name){\n        if(!this.callid) this.callid = 0;\n        this.callid++;\n        let callid = this.callid;\n\n        await this.sleep(500);\n\n        if(callid != this.callid) return this.lastResult || [];\n\n        let req = await allIndexBundle.lib.makeAPIRequest({\n            env, path: `/assets`,\n            qs: name ? {filter: `nameContains=${name}`} : undefined,\n        })\n        this.lastCall = Date.now();\n\n        return this.lastResult = req.data;\n    },\n\n    async content(args){\n        configHelpers.addAutoCompletePrompt();\n        let q = await configHelpers.inquirer.prompt([{\n            type: \"autocomplete\",\n            name: \"what\",\n            message: `What asset do you want?`,\n            source: async (sofar, input) => {\n                let assets = await this.getAssets(args.env, input);\n                assets = assets.map(x => new Asset({data: x, remote: args.env}));\n                return assets.map(x => ({\n                    name: x.chalkPrint(true) + \": \" + x.data.links.self.replace(\"/api/v2/assets/\", \"/content/\"),\n                    value: x,\n                }));\n            },\n        }]);\n    },\n\n    async [\"@\"](args){\n        args._.unshift(\"-\");\n        args._.unshift(\"make\");\n        return this.supply(args);\n    },\n\n    async test(args){\n        let asset = await Asset.getByName(\"UAT\", args.name);\n        log(asset);\n    },\n\n    //Used to test startup and teardown speed.\n    noop(){\n        return true;\n    },\n};\nasync function unknownCommand(cmd){\n    log(chalk`Unknown command {red ${cmd}}.`);\n}\n\nasync function noCommand(){\n    write(chalk`\nRally Tools {yellow v${packageVersion} (alpha)} CLI\nby John Schmidt <John_Schmidt@discovery.com>\n`);\n\n    //Prompt users to setup one time config.\n    if(!configObject.hasConfig){\n        write(chalk`\nIt looks like you haven't setup the config yet. Please run '{green rally config}'.\n`);\n        return;\n    }\n\n    //API Access tests\n    for(let env of [\"LOCAL\", \"DEV\", \"UAT\", \"QA\", \"PROD\"]){\n        //Test access. Returns HTTP response code\n        let resultStr;\n        try{\n            let result = await funcs.testAccess(env);\n\n            //Create a colored display and response\n            resultStr = chalk`{yellow ${result} <unknown>}`;\n            if(result === 200) resultStr = chalk`{green 200 OK}`;\n            else if(result === 401) resultStr = chalk`{red 401 No Access}`;\n            else if(result >= 500)  resultStr = chalk`{yellow ${result} API Down?}`;\n            else if(result === true) resultStr = chalk`{green OK}`;\n            else if(result === false) resultStr = chalk`{red BAD}`;\n        }catch(e){\n            if(e instanceof UnconfiguredEnvError){\n                resultStr = chalk`{yellow Unconfigured}`;\n            }else if(e instanceof APIError){\n                if(!e.response.body){\n                    resultStr = chalk`{red Timeout (?)}`;\n                }\n            }else if(e.name == \"RequestError\"){\n                resultStr = chalk`{red Low level error (check internet): ${e.error.errno}}`;\n            }else{\n                throw e;\n            }\n        }\n\n        log(chalk`   ${env}: ${resultStr}`);\n    }\n}\n\nasync function $main(){\n    //Supply --config to load a different config file\n    if(argv.config) loadConfig(argv.config);\n\n    // First we need to decide if the user wants color or not. If they do want\n    // color, we need to make sure we use the right mode\n    chalk.enabled = configObject.hasConfig ? configObject.chalk : true;\n    if(chalk.level === 0 || !chalk.enabled){\n        let force = argv[\"force-color\"];\n        if(force){\n            chalk.enabled = true;\n            if(force === true && chalk.level === 0){\n                chalk.level = 1;\n            }else if(Number(force)){\n                chalk.level = Number(force);\n            }\n        }\n    }\n\n    //This flag being true allows you to modify UAT and PROD\n    if(!argv[\"protect\"]){\n        configObject.dangerModify = true;\n    }\n\n    //This enables raw output for some functions\n    if(argv[\"raw\"]){\n        configObject.rawOutput = true;\n        global.log = ()=>{};\n        global.errorLog = ()=>{};\n        global.write = ()=>{};\n    }\n\n    if(argv[\"ignore-missing\"]){\n        configObject.ignoreMissing = true;\n    }\n\n    //Default enviornment should normally be from config, but it can be\n    //overridden by the -e/--env flag\n    if(configObject.defaultEnv){\n        argv.env = argv.env || configObject.defaultEnv;\n    }\n\n    //Enable verbose logging in some places.\n    if(argv[\"vverbose\"]){\n        configObject.verbose = argv[\"vverbose\"];\n        configObject.vverbose = true;\n    }else if(argv[\"verbose\"]){\n        configObject.verbose = argv[\"verbose\"]\n    }else if(argv[\"vvverbose\"]){\n        configObject.verbose = true;\n        configObject.vverbose = true;\n        configObject.vvverbose = true;\n    }\n\n    //copy argument array to new object to allow modification\n    argv._old = argv._.slice();\n\n    //Take first argument after `node bundle.js`\n    //If there is no argument, display the default version info and API access.\n    let func = argv._.shift();\n    if(func){\n        if(!cli[func]) return await unknownCommand(func);\n        try{\n            //Call the cli function\n            let ret = await cli[func](argv);\n            if(ret){\n                write(chalk.white(\"CLI returned: \"));\n                if(ret instanceof Collection) ret = ret.arr;\n\n                //Directly use console.log so that --raw works as intended.\n                if(typeof ret === \"object\"){\n                    console.log(JSON.stringify(ret, null, 4));\n                }else{\n                    console.log(ret);\n                }\n            }\n        }catch(e){\n            if(e instanceof AbortError){\n                log(chalk`{red CLI Aborted}: ${e.message}`);\n            }else{\n                throw e;\n            }\n        }\n    }else{\n        await noCommand();\n    }\n}\n\nasync function main(...args){\n    //Catch all for errors to avoid ugly default node promise catcher\n    try{\n        await $main(...args);\n    }catch(e){\n        errorLog(e.stack);\n    }\n}\n\n// If this is an imported module, then we should exec the cli interface.\n// Oterwise just export everything.\nif(require.main === module){\n    main();\n}else{\n    module.exports = allIndexBundle;\n}\n"],"names":["configFile","homedir","configObject","loadConfig","file","hasConfig","json","readFileSync","JSON","parse","e","code","setConfig","obj","helpEntries","helpEntry","name","helpText","text","func","arg","long","short","desc","args","unshift","param","params","usage","replace","chalk","deepAccess","path","o","key","defineAssoc","classname","shortname","split","lastKey","pop","Object","defineProperty","prototype","get","set","val","spawn","options","Promise","resolve","reject","start","performance","now","stdout","stderr","cp","cp_spawn","on","chunk","write","end","time","timestr","exitCode","rp","importLazy","global","log","console","process","elog","ewrite","errorLog","map","red","lib","makeAPIRequest","env","path_full","payload","body","method","qs","headers","fullResponse","timeout","config","api","UnconfiguredEnvError","dangerModify","restrictUAT","ProtectedEnvError","rally_api_key","rally_api","url","stringify","vverbose","vvverbose","requestOptions","uri","auth","bearer","Accept","simple","resolveWithFullResponse","response","cause","APIError","includes","statusCode","contentType","isJSONResponse","AbortError","indexPath","all","opts","numPages","pageSize","links","last","data","next","observe","str","exec","slice","arrayChunk","array","chunkSize","newArr","i","length","push","doPromises","promises","result","cb","promise","res","clearProgress","size","repeat","drawProgress","max","pct","Number","numFilled","Math","floor","numEmpty","indexPathFast","baselink","first","linkToPage","page","allResults","chunksize","limit","req","item","isLocalEnv","envName","Error","constructor","message","captureStackTrace","Collection","arr","Symbol","iterator","findById","id","find","x","findByName","findByNameContains","d","chalkPrint","RallyBase","isLoaded","hasLoadedAll","getById","getAll","endpoint","remote","included","getByName","filter","getAllPreCollect","datas","removeCache","undefined","resolveApply","type","dataObj","direction","resolveField","isArray","field","relationships","cleanup","entries","organization","Provider","meta","getEditorConfig","editorConfig","fileExt","getFileExtension","providers","sort","a","b","attributes","category","localeCompare","python","getmap","lang","pad","String","padStart","Asset","metadata","normalizeMetadata","newMetadata","md","lite","createNew","delete","addFile","label","fileuris","Array","instances","startWorkflow","jobName","initData","startEvaluate","presetid","movie","preset","colon","siloLike","pathTransform","invertedPath","fs","writeFileSync","exists","Preset","pathResolve","dirname","pathspl","ext","getLocalCode","ignoreMissing","missing","parseFilenameForName","parseCodeForName","getLocalMetadata","isGeneric","localmetadatapath","newShell","rallyConfiguration","systemManaged","fromMetadata","providerType","provider","realpath","getLocalPath","acclimatize","ptype","test","regex","match","matches","runTest","asset","startsWith","proType","saveLocal","saveLocalMetadata","saveLocalFile","localpath","uploadRemote","uploadCodeToEnv","save","saved","downloadCode","providerData","_code","v","endsWith","basename","name_regex","findStringsInCode","strings","RegExp","join","repodir","_path","_nameOuter","_nameInner","value","fname","bname","substring","immutable","uploadPresetData","grabMetadata","includeMetadata","shouldTest","Notification","notifications","Rule","f","pNext","eNext","dynamicNexts","enterNotif","errorNotif","passNotif","saveA","createIfNotExist","saveB","idMap","patchStrip","createdAt","starred","updatedAt","passMetadata","errorMetadata","SupplyChain","startingRule","stopRule","calculate","allRules","allPresets","allProviders","allNotifications","COLUMNS","allRuleNames","allPresetNames","allNotifNames","requiredNotifications","Set","ruleQueue","presetQueue","currentRule","forEach","n","add","neededPresets","neededRules","notif","p","verbose","rules","presets","syncTo","rule","require","install","rallyFunctions","bestPagintation","silentAPI","dl","timeEnd","uploadPresets","createFunc","testAccess","testCases","recursivePatch","target","patch","testFunction","uuid","digits","random","pow","base","self","version","SdviContentMover","SdviEvaluate","inquirer","readdir","hasAutoCompletePrompt","addAutoCompletePrompt","registerPrompt","$api","propArray","defaults","DEV","UAT","QA","PROD","q","envs","prompt","choices","keys","checked","questions","defaultKey","default","concat","$chalk","askQuestion","$restrictUAT","$repodir","$defaultEnv","selectProvider","autoDefault","defaultProvider","source","sofar","input","toLowerCase","selectLocal","typeName","Class","basePath","objs","objsMap","none","selectPreset","purpose","selectRule","askInput","question","def","ok","argv","argparse","string","protect","alias","printHelp","help","getFilesFromArgs","lastArg","_","shift","files","getStdin","stdin","presetsub","before","$grab","full","remo","$create","configHelpers","baseCode","$list","attach","rawOutput","$upload","funcs","$diff","preset2","tempfile","temp","extension","ptr","command","stdio","unknown","rulesub","passNext","errorNext","transition","description","jupytersub","output","$build","cmd","categorizeString","trim","supplysub","$calc","stopName","stop","chain","postAction","to","otherPresets","printPresets","otherPreset","$make","subCommand","object","after","ret","cli","helpArg","jupyter","printArgs","supply","ident","pro","econfig","raw","completions","prop","newConfigObject","helperName","newConfig","y","mode","checkSegments","allIndexBundle","segments","userMetaData","r","reduce","lastSegment","ind","curSegment","startTime","endTime","replaceItem","unitTest","findLeslie","allLesieLike","listAssets","tag","noRelationships","listSegments","segs","test2","wfr","wfrm","test3","sleep","setTimeout","getAssets","callid","lastResult","lastCall","Date","content","assets","noop","unknownCommand","noCommand","packageVersion","resultStr","error","errno","$main","enabled","level","force","defaultEnv","_old","white","main","stack","module","exports"],"mappings":"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"}